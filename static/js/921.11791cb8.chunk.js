"use strict";(self.webpackChunkslim=self.webpackChunkslim||[]).push([[921],{9921:(e,t,i)=>{i.d(t,{A:()=>gi});var n=i(5043),s=i(3216),o=i(5475),a=i(5627),r=i(903),l=i(2774),c=i(6080),d=i(2073),h=i(263),u=i(6485),p=i(579);class m extends n.Component{render(){let e="horizontal",t="14px";void 0!==this.props.hasLongValues&&this.props.hasLongValues&&(e="vertical",t="20px");const i=this.props.attributes.map(((e,i)=>{const n=(0,d.A)();return(0,p.jsx)(h.A.Item,{label:e.name,labelStyle:{lineHeight:t},contentStyle:{fontWeight:600,whiteSpace:"pre-line",lineHeight:"14px"},span:1,children:e.value},n)}));let n=null;return void 0!==this.props.icon&&(n=(0,p.jsx)(this.props.icon,{})),(0,p.jsxs)(u.A,{title:this.props.header,extra:n,size:"small",hoverable:this.props.selectable,bordered:void 0!==this.props.header,actions:this.props.methods,children:[(0,p.jsx)(h.A,{column:1,size:"small",layout:e,bordered:!1,children:i}),this.props.children]})}}const g=m;class S extends n.Component{render(){const e=[];return null!=this.props.metadata.ClinicalTrialSponsorName&&e.push({name:"Sponsor Name",value:this.props.metadata.ClinicalTrialSponsorName},{name:"Protocol ID",value:this.props.metadata.ClinicalTrialProtocolID},{name:"Protocol Name",value:this.props.metadata.ClinicalTrialProtocolName},{name:"Site Name",value:this.props.metadata.ClinicalTrialSiteName}),null!=this.props.metadata.ClinicalTrialTimePointID&&e.push({name:"Time Point ID",value:this.props.metadata.ClinicalTrialTimePointID}),(0,p.jsx)(g,{attributes:e})}}const v=S;function y(e){return"object"===typeof e&&null!==e&&void 0!==e&&void 0!==e.Alphabetic?e.Alphabetic.split("^").join(" "):""}function C(e){if(null!==e&&void 0!==e){return`${e.substring(0,4)}-${e.substring(4,6)}-${e.substring(6,8)}`}return""}function f(e){if(null!==e&&void 0!==e){return`${e.substring(0,2)}:${e.substring(2,4)}:${e.substring(4,6)}`}return""}function I(e){return null!==e&&void 0!==e?{F:"Female",M:"Male",O:"Other"}[e]:""}class b extends n.Component{render(){const e=[{name:"ID",value:this.props.metadata.PatientID},{name:"Name",value:y(this.props.metadata.PatientName)},{name:"Gender",value:I(this.props.metadata.PatientSex)},{name:"Birthdate",value:C(this.props.metadata.PatientBirthDate)}];return(0,p.jsx)(g,{attributes:e})}}const w=b;class x extends n.Component{render(){const e=[{name:"Accession #",value:this.props.metadata.AccessionNumber},{name:"ID",value:this.props.metadata.StudyID},{name:"Date",value:C(this.props.metadata.StudyDate)},{name:"Time",value:f(this.props.metadata.StudyTime)}];return(0,p.jsx)(g,{attributes:e})}}const A=x;var D=i(8235);let V=function(e){return e.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE="1.2.840.10008.5.1.4.1.1.77.1.6",e.COMPREHENSIVE_SR="1.2.840.10008.5.1.4.1.1.88.33",e.COMPREHENSIVE_3D_SR="1.2.840.10008.5.1.4.1.1.88.34",e.SEGMENTATION="1.2.840.10008.5.1.4.1.1.66.4",e.MICROSCOPY_BULK_SIMPLE_ANNOTATION="1.2.840.10008.5.1.4.1.1.91.1",e.PARAMETRIC_MAP="1.2.840.10008.5.1.4.1.1.30",e.ADVANCED_BLENDING_PRESENTATION_STATE="1.2.840.10008.5.1.4.1.1.11.8",e.COLOR_SOFTCOPY_PRESENTATION_STATE="1.2.840.10008.5.1.4.1.1.11.2",e.GRAYSCALE_SOFTCOPY_PRESENTATION_STATE="1.2.840.10008.5.1.4.1.1.11.1",e.PSEUDOCOLOR_SOFTCOPY_PRESENTATION_STATE="1.2.840.10008.5.1.4.1.1.11.3",e}({});const R=Symbol("subscriptions"),j=Symbol("lastSubscriptionId");class O{constructor(){this[R]={},this[j]=0}subscribe(e,t){if(void 0===e)throw new Error("Trying to subscribe to an inexistent event");if("function"!==typeof t)throw new Error("The provided callback must be a function");this[R].hasOwnProperty(e)||(this[R][e]={});const i="sub"+this[j]++;this[R][e][i]=t}unsubscribe(e,t){const i=this[R][e]||{};for(const n in i)t?i[n]===t&&delete i[n]:delete i[n]}publish(e){if(void 0===e)throw new Error("Trying to publish an inexistent event");const t=this[R][e]||{};for(var i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];for(const o in t)t[o](...n)}unsubscribeFromAll(){for(const e in this[R]){const t=this[R][e];for(const e in t)delete t[e]}}}var M=i(6904);const P="Authentication",E="Communication",U="EncodingDecoding",T="Visualization";class L extends Error{constructor(e,t){super(),this.message=t,this.stack=(new Error).stack,this.type=e}}const k="onError",_="onWarning",N="dicomweb-client",$="dicom-microscopy-viewer",G="dcmjs",q="slim",F="authentication",z="toast",B="console",W={sources:[{category:P,notificationType:z},{category:E,notificationType:z},{category:T,notificationType:z},{category:U,notificationType:B},{category:"Warning",notificationType:z}]};const Y=new class extends O{constructor(){super();const e=e=>{this.publish(_,Array.from(e).join(" "))};!function(){const t=console.warn;console.warn=function(){JSON.stringify(arguments).includes("request")||e(arguments),t.apply(this,Array.prototype.slice.call(arguments))}}()}onError(e,t){const i=t.type,n=W.sources.find((e=>e.category===i)),{notificationType:s}=n;let o;switch(this.publish(k,{source:e,error:t}),o=t instanceof L?t.message:String(t),s){case z:return console.error(`A ${i} error occurred: `,t),M.A.error({message:`${i} error`,description:o,duration:3});case B:console.error(`A ${i} error occurred: `,t)}}};class H extends n.Component{constructor(e){super(e),this.state={isLoading:!1},this.overviewViewportRef=n.createRef(),this.overviewViewer=void 0,this.overviewViewer=void 0}componentDidMount(){if(this.setState({isLoading:!0}),this.props.slide.overviewImages.length>0){const e=this.props.slide.overviewImages[0];null!==this.overviewViewportRef.current&&(this.overviewViewportRef.current.innerHTML="",console.info(`instantiate viewer for OVERVIEW image of slide "${e.ContainerIdentifier}"`),this.overviewViewer=new D.viewer.OverviewImageViewer({client:this.props.clients[V.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE],metadata:e,resizeFactor:1,errorInterceptor:e=>{Y.onError($,e)}}),this.overviewViewer.render({container:this.overviewViewportRef.current}))}this.setState({isLoading:!1})}render(){void 0!==this.overviewViewer&&this.overviewViewer.resize();const e=[],t=this.props.slide.description;return null!=t&&""!==t&&e.push({name:"Description",value:t}),this.state.isLoading?(0,p.jsx)(l.hW,{}):(0,p.jsx)(c.A.Item,{style:{height:"100%"},...this.props,children:(0,p.jsx)(g,{header:this.props.slide.containerIdentifier,attributes:e,selectable:!0,children:null!=this.overviewViewportRef.current&&(0,p.jsx)("div",{style:{height:"100px"},ref:this.overviewViewportRef})})},this.props.slide.seriesInstanceUIDs[0])}}const X=H;class K extends n.Component{constructor(){super(...arguments),this.state={selectedSeriesInstanceUID:this.props.selectedSeriesInstanceUID}}componentDidMount(){this.props.onSeriesSelection({seriesInstanceUID:this.state.selectedSeriesInstanceUID})}render(){const e=this.props.metadata,t=[];for(let n=0;n<e.length;++n){const i=e[n],s=(0,p.jsx)(X,{slide:i,clients:this.props.clients},i.seriesInstanceUIDs[0]);t.push(s)}let i;return void 0!==this.state.selectedSeriesInstanceUID&&null!==this.state.selectedSeriesInstanceUID&&(i=[this.state.selectedSeriesInstanceUID]),(0,p.jsx)(c.A,{style:{width:"100%"},selectedKeys:i,onSelect:e=>{let{key:t,keyPath:i,domEvent:n,selectedKeys:s}=e;console.info(`select slide "${t}"`),this.setState({selectedSeriesInstanceUID:t.toString()}),this.props.onSeriesSelection({seriesInstanceUID:t.toString()})},mode:"inline",inlineIndent:0,children:t})}}const Q=K;var J=i(4406),Z=i(8186),ee=i(4435),te=i(5696),ie=i(1802),ne=i(7419),se=i(9998),oe=i(8652),ae=i(3428),re=i(5574),le=i(3390),ce=i(599),de=i(7785),he=i(1264);class ue extends n.Component{constructor(e){super(e),this.handleVisibilityChange=this.handleVisibilityChange.bind(this)}handleVisibilityChange(e,t){this.props.onVisibilityChange({roiUID:this.props.roi.uid,isVisible:e})}render(){const e=`ROI ${this.props.index+1}`,t=[],{isVisible:i,onVisibilityChange:n,...s}=this.props;return this.props.roi.evaluations.forEach((e=>{const i=e.ConceptNameCodeSequence[0].CodeValue,n=`${e.ConceptNameCodeSequence[0].CodeMeaning}`;if(e.ValueType===de.sr.valueTypes.ValueTypes.CODE){const s=e.ConceptCodeSequence[0].CodeMeaning;"276214006"===i?t.push({name:"Property category",value:`${s}`}):"121071"===i?t.push({name:"Property type",value:`${s}`}):"111001"===i?t.push({name:"Algorithm Name",value:`${s}`}):t.push({name:n,value:`${s}`})}else if(e.ValueType===de.sr.valueTypes.ValueTypes.TEXT){const i=e;t.push({name:n,value:i.TextValue})}})),this.props.roi.measurements.forEach((e=>{const i=`${e.ConceptNameCodeSequence[0].CodeMeaning}`,n=e.MeasuredValueSequence[0],s=n.NumericValue.toPrecision(6),o=n.MeasurementUnitsCodeSequence[0].CodeValue;t.push({name:i,value:`${s} ${o}`})})),(0,p.jsxs)(ee.A,{align:"start",children:[(0,p.jsx)("div",{style:{paddingLeft:"14px"},children:(0,p.jsx)(he.A,{size:"small",onChange:this.handleVisibilityChange,checked:this.props.isVisible,checkedChildren:(0,p.jsx)(l.Ny1,{}),unCheckedChildren:(0,p.jsx)(l.mx3,{})})}),(0,p.jsx)(c.A.Item,{style:{height:"100%",paddingLeft:"3px"},...s,children:(0,p.jsx)(g,{header:e,attributes:t,selectable:!0,hasLongValues:!0})},this.props.roi.uid)]})}}const pe=ue;class me extends n.Component{constructor(e){super(e),this.handleMenuItemSelection=this.handleMenuItemSelection.bind(this),this.handleVisibilityChange=this.handleVisibilityChange.bind(this)}handleVisibilityChange(e,t){e?this.props.rois.forEach((t=>{this.props.onVisibilityChange({roiUID:t.uid,isVisible:e})})):this.props.visibleRoiUIDs.forEach((t=>{this.props.onVisibilityChange({roiUID:t,isVisible:e})}))}handleMenuItemSelection(e){this.props.onSelection({roiUID:e.key})}render(){const e=this.props.rois.map(((e,t)=>(0,p.jsx)(pe,{roi:e,index:t,isVisible:this.props.visibleRoiUIDs.has(e.uid),onVisibilityChange:this.props.onVisibilityChange},e.uid)));return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{style:{paddingLeft:"14px",paddingTop:"7px",paddingBottom:"7px"},children:(0,p.jsx)(he.A,{size:"small",onChange:this.handleVisibilityChange,checked:this.props.visibleRoiUIDs.size>0,checkedChildren:(0,p.jsx)(l.Ny1,{}),unCheckedChildren:(0,p.jsx)(l.mx3,{})})}),(0,p.jsx)(c.A,{selectedKeys:[...this.props.selectedRoiUIDs.values()],onSelect:this.handleMenuItemSelection,onClick:this.handleMenuItemSelection,children:e})]})}}const ge=me;var Se=i(1645),ve=i(8492),ye=i(2857),Ce=i(5832),fe=i(4524);class Ie extends n.Component{constructor(e){super(e),this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.handleMeasurementSelection=this.handleMeasurementSelection.bind(this),this.handleOpacityChange=this.handleOpacityChange.bind(this),this.handleColorRChange=this.handleColorRChange.bind(this),this.handleColorGChange=this.handleColorGChange.bind(this),this.handleColorBChange=this.handleColorBChange.bind(this),this.getCurrentColor=this.getCurrentColor.bind(this),this.state={isVisible:this.props.isVisible,currentStyle:{opacity:this.props.defaultStyle.opacity,color:this.props.defaultStyle.color}}}handleVisibilityChange(e,t){this.props.onVisibilityChange({annotationGroupUID:this.props.annotationGroup.uid,isVisible:e}),this.setState({isVisible:e})}handleOpacityChange(e){null!=e&&(this.props.onStyleChange({uid:this.props.annotationGroup.uid,styleOptions:{opacity:e}}),this.setState({currentStyle:{opacity:e,color:this.state.currentStyle.color,limitValues:this.state.currentStyle.limitValues}}))}handleColorRChange(e){if(null!=e&&void 0!==this.state.currentStyle.color){const t=[Array.isArray(e)?e[0]:e,this.state.currentStyle.color[1],this.state.currentStyle.color[2]];this.setState((e=>({currentStyle:{color:t,opacity:e.currentStyle.opacity,limitValues:e.currentStyle.limitValues}}))),this.props.onStyleChange({uid:this.props.annotationGroup.uid,styleOptions:{color:t}})}}handleColorGChange(e){if(null!=e&&void 0!==this.state.currentStyle.color){const t=[this.state.currentStyle.color[0],Array.isArray(e)?e[0]:e,this.state.currentStyle.color[2]];this.setState((e=>({currentStyle:{color:t,opacity:e.currentStyle.opacity,limitValues:e.currentStyle.limitValues}}))),this.props.onStyleChange({uid:this.props.annotationGroup.uid,styleOptions:{color:t}})}}handleColorBChange(e){if(null!=e&&void 0!==this.state.currentStyle.color){const t=[this.state.currentStyle.color[0],this.state.currentStyle.color[1],Array.isArray(e)?e[0]:e];this.setState((e=>({currentStyle:{color:t,opacity:e.currentStyle.opacity,limitValues:e.currentStyle.limitValues}}))),this.props.onStyleChange({uid:this.props.annotationGroup.uid,styleOptions:{color:t}})}}getCurrentColor(){return null!=this.state.currentStyle.color?"#"+(16777216+((e=this.state.currentStyle.color)[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1):"white";var e}handleLowerLimitChange(e){null!=e&&void 0!==this.state.currentStyle.limitValues&&(this.setState((t=>void 0!==t.currentStyle.limitValues?{currentStyle:{color:t.currentStyle.color,opacity:t.currentStyle.opacity,limitValues:[e,t.currentStyle.limitValues[1]]}}:{currentStyle:{color:t.currentStyle.color,opacity:t.currentStyle.opacity,limitValues:t.currentStyle.limitValues}})),this.props.onStyleChange({uid:this.props.annotationGroup.uid,styleOptions:{limitValues:[e,this.state.currentStyle.limitValues[1]]}}))}handleUpperLimitChange(e){null!=e&&void 0!==this.state.currentStyle.limitValues&&(this.setState((t=>void 0!==t.currentStyle.limitValues?{currentStyle:{color:t.currentStyle.color,opacity:t.currentStyle.opacity,limitValues:[t.currentStyle.limitValues[0],e]}}:{currentStyle:{color:t.currentStyle.color,opacity:t.currentStyle.opacity,limitValues:t.currentStyle.limitValues}})),this.props.onStyleChange({uid:this.props.annotationGroup.uid,styleOptions:{limitValues:[this.state.currentStyle.limitValues[0],e]}}))}handleLimitChange(e){this.setState((t=>({currentStyle:{color:t.currentStyle.color,opacity:t.currentStyle.opacity,limitValues:e}}))),this.props.onStyleChange({uid:this.props.annotationGroup.uid,styleOptions:{limitValues:e}})}handleMeasurementSelection(e,t){if(null!=e&&null!=t.children){const i=e.split("-"),n=new de.sr.coding.CodedConcept({value:i[1],schemeDesignator:i[0],meaning:t.children});this.props.onStyleChange({uid:this.props.annotationGroup.uid,styleOptions:{measurement:n}}),this.setState((e=>({currentStyle:{opacity:e.currentStyle.opacity,measurement:n}})))}else this.props.onStyleChange({uid:this.props.annotationGroup.uid,styleOptions:{color:this.props.defaultStyle.color}}),this.setState((e=>({currentStyle:{opacity:e.currentStyle.opacity,color:this.props.defaultStyle.color,limitValues:void 0}})))}render(){var e;const t=this.props.metadata.AnnotationGroupSequence.findIndex((e=>e.AnnotationGroupUID===this.props.annotationGroup.uid)),i=this.props.metadata.AnnotationGroupSequence[t],n=[{name:"Property type",value:this.props.annotationGroup.propertyType.CodeMeaning},{name:"Property category",value:this.props.annotationGroup.propertyCategory.CodeMeaning},{name:"Graphic type",value:i.GraphicType},{name:"Annotation coordinate type",value:this.props.metadata.AnnotationCoordinateType}],s=null!==(e=i.MeasurementsSequence)&&void 0!==e?e:[],o=s.map(((e,t)=>{const i=e.ConceptNameCodeSequence[0];return(0,p.jsx)(J.A.Option,{value:`${i.CodingSchemeDesignator}-${i.CodeValue}`,dropdownMatchSelectWidth:!1,size:"small",disabled:!this.props.isVisible,children:i.CodeMeaning},t)}));let a,r,d;if(o.push((0,p.jsx)(J.A.Option,{value:void 0,dropdownMatchSelectWidth:!1,size:"small",disabled:!this.props.isVisible,children:(0,p.jsx)(p.Fragment,{})},"-")),null!=this.state.currentStyle.color&&(a=(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(se.A,{plain:!0,children:"Color"}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:5,children:"Red"}),(0,p.jsx)(Se.A,{span:14,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:255,step:1,value:this.state.currentStyle.color[0],onChange:this.handleColorRChange})}),(0,p.jsx)(Se.A,{span:5,children:(0,p.jsx)(ae.A,{min:0,max:255,size:"small",style:{width:"65px"},value:this.state.currentStyle.color[0],onChange:this.handleColorRChange})})]}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:5,children:"Green"}),(0,p.jsx)(Se.A,{span:14,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:255,step:1,value:this.state.currentStyle.color[1],onChange:this.handleColorGChange})}),(0,p.jsx)(Se.A,{span:5,children:(0,p.jsx)(ae.A,{min:0,max:255,size:"small",style:{width:"65px"},value:this.state.currentStyle.color[1],onChange:this.handleColorGChange})})]}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:5,children:"Blue"}),(0,p.jsx)(Se.A,{span:14,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:255,step:1,value:this.state.currentStyle.color[2],onChange:this.handleColorBChange})}),(0,p.jsx)(Se.A,{span:5,children:(0,p.jsx)(ae.A,{min:0,max:255,size:"small",style:{width:"65px"},value:this.state.currentStyle.color[2],onChange:this.handleColorBChange})})]}),(0,p.jsx)(se.A,{plain:!0})]})),s.length>0){if(null!=this.state.currentStyle.limitValues){const e=0,t=1e3;r=(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(se.A,{plain:!0,children:"Values of interest"}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:6,children:(0,p.jsx)(ae.A,{min:0,max:this.state.currentStyle.limitValues[1],size:"small",style:{width:"75px"},value:this.state.currentStyle.limitValues[0],onChange:this.handleLowerLimitChange})}),(0,p.jsx)(Se.A,{span:12,children:(0,p.jsx)(ve.A,{range:!0,min:e,max:t,step:1,value:[this.state.currentStyle.limitValues[0],this.state.currentStyle.limitValues[1]],onChange:this.handleLimitChange})}),(0,p.jsx)(Se.A,{span:6,children:(0,p.jsx)(ae.A,{min:this.state.currentStyle.limitValues[0],max:t,size:"small",style:{width:"75px"},value:this.state.currentStyle.limitValues[1],onChange:this.handleUpperLimitChange})})]})]})}d=(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(se.A,{plain:!0,children:"Exploration"}),(0,p.jsxs)(ne.A,{justify:"start",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:8,children:"Measurement"}),(0,p.jsx)(Se.A,{span:16,children:(0,p.jsx)(J.A,{style:{minWidth:"65px",width:"90%"},onSelect:this.handleMeasurementSelection,defaultValue:void 0,children:o},"annotation-group-measurements")})]})]})}const h=(0,p.jsxs)("div",{children:[a,r,(0,p.jsxs)(ne.A,{justify:"start",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:6,children:"Opacity"}),(0,p.jsx)(Se.A,{span:12,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:1,step:.01,value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})}),(0,p.jsx)(Se.A,{span:6,children:(0,p.jsx)(ae.A,{min:0,max:1,size:"small",step:.1,style:{width:"65px"},value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})})]}),d]}),u=this.getCurrentColor(),m=this.state.isVisible&&null==this.state.currentStyle.measurement,{annotationGroup:S,defaultStyle:v,isVisible:y,metadata:C,onVisibilityChange:f,onStyleChange:I,...b}=this.props;return(0,p.jsx)(c.A.Item,{style:{height:"100%",paddingLeft:"3px"},...b,children:(0,p.jsxs)(ee.A,{align:"start",children:[(0,p.jsx)("div",{style:{paddingLeft:"14px"},children:(0,p.jsxs)(ee.A,{direction:"vertical",align:"end",children:[(0,p.jsx)(he.A,{size:"small",onChange:this.handleVisibilityChange,checked:this.props.isVisible,checkedChildren:(0,p.jsx)(l.Ny1,{}),unCheckedChildren:(0,p.jsx)(l.mx3,{})}),(0,p.jsx)(ye.A,{placement:"left",content:h,overlayStyle:{width:"350px"},title:"Display Settings",children:(0,p.jsx)(ie.A,{type:"primary",shape:"circle",icon:(0,p.jsx)(fe.A,{})})})]})}),(0,p.jsx)(Ce.A,{offset:[-20,20],count:" ",style:{borderStyle:"solid",borderWidth:"1px",borderColor:"gray",visibility:m?"visible":"hidden",backgroundImage:`linear-gradient(to bottom, ${u}, ${u}`},children:(0,p.jsx)(g,{header:this.props.annotationGroup.label,attributes:n,selectable:!0,hasLongValues:!0})})]})},this.props.annotationGroup.uid)}}const be=Ie;class we extends n.Component{render(){const e=this.props.annotationGroups.map(((e,t)=>{const i=e.uid;return(0,p.jsx)(be,{annotationGroup:e,metadata:this.props.metadata[i],isVisible:this.props.visibleAnnotationGroupUIDs.has(i),defaultStyle:this.props.defaultAnnotationGroupStyles[i],onVisibilityChange:this.props.onAnnotationGroupVisibilityChange,onStyleChange:this.props.onAnnotationGroupStyleChange},e.uid)}));return(0,p.jsx)(c.A,{selectable:!1,children:e})}}const xe=we;class Ae extends n.Component{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(e){void 0!==this.props.onClick&&this.props.onClick(e)}render(){var e;const t=this.props.icon;if(void 0===t)return null;let i,n;return null!=this.props.label&&(i=(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(se.A,{type:"vertical"}),this.props.label]})),n=null!==(e=this.props.isSelected)&&void 0!==e&&e?(0,p.jsx)(ie.A,{onClick:this.handleClick,icon:(0,p.jsx)(t,{}),type:"primary",style:{lineHeight:"1.0"},children:i}):(0,p.jsx)(ie.A,{onClick:this.handleClick,icon:(0,p.jsx)(t,{}),type:"default",style:{lineHeight:"1.0"},children:i}),void 0!==this.props.tooltip?(0,p.jsx)(te.A,{title:this.props.tooltip,children:n}):n}}const De=Ae;class Ve extends n.Component{render(){if(void 0===this.props.metadata)return null;const e=[{name:"Manufacturer",value:this.props.metadata.Manufacturer},{name:"Model Name",value:this.props.metadata.ManufacturerModelName},{name:"Device Serial Number",value:this.props.metadata.DeviceSerialNumber},{name:"Software Versions",value:this.props.metadata.SoftwareVersions}];return null!=this.props.metadata.InstitutionName&&e.push({name:"Institution Name",value:this.props.metadata.InstitutionName}),(0,p.jsx)(g,{attributes:e,hasLongValues:!0})}}const Re=Ve,je=e=>{let{content:t,name:i}=e;const n=[];return t.forEach((e=>{((e,t)=>{const i=e.ConceptNameCodeSequence[0];return i.CodeValue===t.CodeValue&&i.CodingSchemeDesignator===t.CodingSchemeDesignator})(e,i)&&n.push(e)})),n},Oe=(e,t)=>e.ValueType===t,Me=e=>{const t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"126010",schemeDesignator:"DCM",meaning:"Imaging Measurements"})});1!==t.length&&Y.onError(q,new L(U,'Content item "Imaging Measurements" not found.Content of Comprehensive 3D SR document is not structured based on TID 1500 "Measurement Report".'));const i=t[0],n=je({content:i.ContentSequence,name:new de.sr.coding.CodedConcept({value:"125007",schemeDesignator:"DCM",meaning:"Measurement Group"})}),s=[];return n.forEach((e=>{const t=[];let i;const n=e;let o=je({content:n.ContentSequence,name:new de.sr.coding.CodedConcept({value:"112040",schemeDesignator:"DCM",meaning:"Tracking Unique Identifier"})});0===o.length&&Y.onError(q,new L(U,'Content item "Tracking Unique Identifier" not found. Content of Comprehensive 3D SR document is not structured based on TID 1500 "Measurement Report" -> TID 1410 "Planar ROI Measurements and Qualitative Evaluations".'));const a=o[0];if(o=je({content:n.ContentSequence,name:new de.sr.coding.CodedConcept({value:"121071",schemeDesignator:"DCM",meaning:"Finding"})}),0===o.length&&Y.onError(q,new L(U,'Content item "Finding" not found. Content of Comprehensive 3D SR document is not structured based on TID 1500 "Measurement Report" -> TID 1410 "Planar ROI Measurements and Qualitative Evaluations".')),o=je({content:n.ContentSequence,name:new de.sr.coding.CodedConcept({value:"111001",schemeDesignator:"DCM",meaning:"Algorithm Name"})}),0!==o.length){const e=o[0];t.push(e),i="Device"}else i="Person";if(o=je({content:n.ContentSequence,name:new de.sr.coding.CodedConcept({value:"111003",schemeDesignator:"DCM",meaning:"Algorithm Version"})}),0!==o.length){const e=o[0];t.push(e)}o=je({content:n.ContentSequence,name:new de.sr.coding.CodedConcept({value:"111030",schemeDesignator:"DCM",meaning:"Image Region"})}),0===o.length&&Y.onError(q,new L(U,'Content item "Image Region" not found. Content of Comprehensive 3D SR document is not structured based on TID 1500 "Measurement Report" -> TID 1410 "Planar ROI Measurements and Qualitative Evaluations".'));const r=o[0];let l;if("POINT"===r.GraphicType)l=new D.scoord3d.Point({frameOfReferenceUID:r.ReferencedFrameOfReferenceUID,coordinates:r.GraphicData});else{const e=[];for(let t=0;t<r.GraphicData.length;t+=3)e.push(r.GraphicData.slice(t,t+3));"POLYGON"===r.GraphicType?l=new D.scoord3d.Polygon({frameOfReferenceUID:r.ReferencedFrameOfReferenceUID,coordinates:e}):"MULTIPOINT"===r.GraphicType?l=new D.scoord3d.MultiPoint({frameOfReferenceUID:r.ReferencedFrameOfReferenceUID,coordinates:e}):"POLYLINE"===r.GraphicType?l=new D.scoord3d.Polyline({frameOfReferenceUID:r.ReferencedFrameOfReferenceUID,coordinates:e}):"ELLIPSE"===r.GraphicType?l=new D.scoord3d.Ellipse({frameOfReferenceUID:r.ReferencedFrameOfReferenceUID,coordinates:e}):"ELLIPSOID"===r.GraphicType?l=new D.scoord3d.Ellipsoid({frameOfReferenceUID:r.ReferencedFrameOfReferenceUID,coordinates:e}):Y.onError(q,new L(U,`Content item "Image Region" has unknown graphic type "${r.GraphicType}". Content of Comprehensive 3D SR document is not structured based on TID 1500 "Measurement Report" -> TID 1410 "Planar ROI Measurements and Qualitative Evaluations".`))}t.push(...(e=>{let{content:t}=e;const i=[];return t.forEach((e=>{if(Oe(e,de.sr.valueTypes.ValueTypes.CODE)){const t=e;i.push(t)}})),i})({content:n.ContentSequence}));const c=(e=>{let{content:t}=e;const i=[];return t.forEach((e=>{if(Oe(e,de.sr.valueTypes.ValueTypes.NUM)){const t=e;i.push(t)}})),i})({content:n.ContentSequence}),h=new D.roi.ROI({scoord3d:l,uid:(0,d.A)(),properties:{trackingUID:a.UID,observerType:i,evaluations:t,measurements:c}});s.push(h)})),s};class Pe{constructor(e){this.PersonObserverName=void 0,this.PersonObserverLoginName=void 0,this.DeviceObserverUID=void 0,this.DeviceObserverName=void 0,this.SpecimenUID=void 0,this.SpecimenIdentifier=void 0,this.ContainerIdentifier=void 0,this.ROIs=[];let t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"121039",schemeDesignator:"DCM",meaning:"Specimen UID"})});0===t.length&&Y.onError(q,new L(U,'Content item "Specimen UID" not found. Content of Comprehensive 3D SR document is not structured based on TID 1500 "Measurement Report" -> TID 1001 "Observation Context" -> TID 1006 "Subject Context" -> TID 1009 "Subject Context, Specimen".'));const i=t[0];this.SpecimenUID=i.UID,t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"121041",schemeDesignator:"DCM",meaning:"Specimen Identifier"})}),0===t.length&&Y.onError(q,new L(U,'Content item "Specimen Identifier" not found. Content of Comprehensive 3D SR document is not structured based on TID 1500 "Measurement Report" -> TID 1001 "Observation Context" -> TID 1006 "Subject Context" -> TID 1009 "Subject Context, Specimen".'));const n=t[0];this.SpecimenIdentifier=n.TextValue,t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"111700",schemeDesignator:"DCM",meaning:"Specimen Container Identifier"})}),0===t.length&&Y.onError(q,new L(U,'Content item "Specimen Container Identifier" not found. Content of Comprehensive 3D SR document is not structured based on TID 1500 "Measurement Report" -> TID 1001 "Observation Context" -> TID 1006 "Subject Context" -> TID 1009 "Subject Context, Specimen".'));const s=t[0];if(this.ContainerIdentifier=s.TextValue,t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"121008",schemeDesignator:"DCM",meaning:"Person Observer Name"})}),0!==t.length){const e=t[0];this.PersonObserverName=e.PersonName}if(t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"128774",schemeDesignator:"DCM",meaning:"Person Observer's Login Name"})}),0!==t.length){const e=t[0];this.PersonObserverLoginName=e.TextValue}if(t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"121012",schemeDesignator:"DCM",meaning:"Device Observer UID"})}),t.length>0){const e=t[0];this.DeviceObserverUID=e.UID}if(t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"121013",schemeDesignator:"DCM",meaning:"Device Observer Name"})}),0!==t.length){const e=t[0];this.DeviceObserverName=e.TextValue}this.ROIs=Me(e)}}class Ee extends n.Component{render(){const e=new Pe(this.props.dataset),t=[{name:"ID",value:e.ContainerIdentifier}],i=[{name:"ID",value:e.SpecimenIdentifier}],n=[{name:"Name",value:e.PersonObserverName}],s=e.ROIs.map(((e,t)=>{const i=`Region ${t+1}`,n=[];return e.evaluations.forEach((e=>{e.ValueType===de.sr.valueTypes.ValueTypes.CODE?n.push({name:e.ConceptNameCodeSequence[0].CodeMeaning,value:e.ConceptCodeSequence[0].CodeMeaning}):e.ValueType===de.sr.valueTypes.ValueTypes.TEXT&&n.push({name:e.ConceptNameCodeSequence[0].CodeMeaning,value:e.TextValue})})),(0,p.jsx)(g,{header:i,attributes:n},e.uid)}));return(0,p.jsxs)("div",{children:[(0,p.jsx)(se.A,{orientation:"left",children:"Patient"}),(0,p.jsx)(w,{metadata:this.props.dataset}),(0,p.jsx)(se.A,{orientation:"left",children:"Case"}),(0,p.jsx)(A,{metadata:this.props.dataset}),(0,p.jsx)(se.A,{orientation:"left",children:"Slide"}),(0,p.jsx)(g,{attributes:t}),(0,p.jsx)(se.A,{orientation:"left",children:"Specimen"}),(0,p.jsx)(g,{attributes:i}),(0,p.jsx)(se.A,{orientation:"left",children:"Observer"}),(0,p.jsx)(g,{attributes:n}),(0,p.jsx)(se.A,{orientation:"left",children:"Annotations"}),s]})}}const Ue=Ee;var Te=i(5639);class Le extends n.Component{render(){let e,t=null;return void 0!==this.props.groups&&(t=this.props.groups.map(((e,t)=>(0,p.jsx)(g,{header:e.name,attributes:e.attributes},t)))),e=void 0!==this.props.type?`${this.props.type}: ${this.props.identifier}`:this.props.identifier,(0,p.jsxs)(Te.Ay.Item,{children:[(0,p.jsx)(g,{header:e,attributes:this.props.attributes,hasLongValues:this.props.hasLongValues,children:t}),this.props.children]},this.props.uid)}}const ke=Le,_e=(new de.sr.coding.CodedConcept({value:"17636008",schemeDesignator:"SCT",meaning:"Specimen collection"}),new de.sr.coding.CodedConcept({value:"433465004",schemeDesignator:"SCT",meaning:"Sampling of tissue specimen"}),new de.sr.coding.CodedConcept({value:"127790008",schemeDesignator:"SCT",meaning:"Specimen staining"}),new de.sr.coding.CodedConcept({value:"9265001",schemeDesignator:"SCT",meaning:"Specimen processing"}),{FIXATIVE:new de.sr.coding.CodedConcept({value:"430864009",schemeDesignator:"SCT",meaning:"Tissue fixative"}),EMBEDDING_MEDIUM:new de.sr.coding.CodedConcept({value:"430863003",schemeDesignator:"SCT",meaning:"Embedding medium"})}),Ne={SPECIMEN_IDENTIFIER:new de.sr.coding.CodedConcept({value:"121041",schemeDesignator:"DCM",meaning:"Specimen identifier"}),PARENT_SPECIMEN_IDENTIFIER:new de.sr.coding.CodedConcept({value:"111705",schemeDesignator:"DCM",meaning:"Parent specimen identifier"}),PROCESSING_TYPE:new de.sr.coding.CodedConcept({value:"111701",schemeDesignator:"DCM",meaning:"Processing type"}),DATETIME_OF_PROCESSING:new de.sr.coding.CodedConcept({value:"111702",schemeDesignator:"DCM",meaning:"Datetime of processing"}),PROCESSING_STEP_DESCRIPTION:new de.sr.coding.CodedConcept({value:"111703",schemeDesignator:"DCM",meaning:"Processing step description"}),COLLECTION_METHOD:new de.sr.coding.CodedConcept({value:"17636008",schemeDesignator:"SCT",meaning:"Specimen collection"}),SAMPLING_METHOD:new de.sr.coding.CodedConcept({value:"111704",schemeDesignator:"DCM",meaning:"Sampling method"}),STAIN:new de.sr.coding.CodedConcept({value:"424361007",schemeDesignator:"SCT",meaning:"Using substance"}),..._e};class $e extends n.Component{render(){var e;if(void 0===this.props.metadata)return null;const t=this.props.metadata.SpecimenDescriptionSequence[this.props.index],i=[];if(void 0!==t.SpecimenShortDescription&&i.push({name:"Description",value:t.SpecimenShortDescription}),void 0!==t.PrimaryAnatomicStructureSequence&&t.PrimaryAnatomicStructureSequence.length>0){const e=t.PrimaryAnatomicStructureSequence;i.push({name:"Anatomical structure",value:e.map((e=>e.CodeMeaning)).join(", ")})}(null!==(e=t.SpecimenPreparationSequence)&&void 0!==e?e:[]).forEach(((e,t)=>{e.SpecimenPreparationStepContentItemSequence.forEach(((e,t)=>{const n=new de.sr.coding.CodedConcept({value:e.ConceptNameCodeSequence[0].CodeValue,schemeDesignator:e.ConceptNameCodeSequence[0].CodingSchemeDesignator,meaning:e.ConceptNameCodeSequence[0].CodeMeaning});if(e.ValueType===de.sr.valueTypes.ValueTypes.CODE){const t=new de.sr.coding.CodedConcept({value:e.ConceptCodeSequence[0].CodeValue,schemeDesignator:e.ConceptCodeSequence[0].CodingSchemeDesignator,meaning:e.ConceptCodeSequence[0].CodeMeaning});n.equals(Ne.PROCESSING_TYPE)||(n.equals(Ne.COLLECTION_METHOD)?i.push({name:"Collection method",value:t.CodeMeaning}):n.equals(Ne.FIXATIVE)?i.push({name:"Tissue fixative",value:t.CodeMeaning}):n.equals(Ne.EMBEDDING_MEDIUM)?i.push({name:"Tissue embedding medium",value:t.CodeMeaning}):n.equals(Ne.STAIN)&&this.props.showstain&&i.push({name:"Tissue stain",value:t.CodeMeaning}))}else e.ValueType===de.sr.valueTypes.ValueTypes.TEXT&&(n.equals(Ne.STAIN)&&this.props.showstain?i.push({name:"Tissue stain",value:e.TextValue}):n.equals(Ne.PARENT_SPECIMEN_IDENTIFIER)&&i.push({name:"Parent specimen",value:e.TextValue}))}))}));const n=t.SpecimenUID,s=t.SpecimenIdentifier;return(0,p.jsx)(ke,{uid:n,identifier:s,attributes:i,hasLongValues:!0},n)}}const Ge=$e;class qe extends n.Component{render(){var e;if(void 0===this.props.metadata)return null;const t=(null!==(e=this.props.metadata.SpecimenDescriptionSequence)&&void 0!==e?e:[]).map(((e,t)=>(0,p.jsx)(Ge,{index:t,metadata:this.props.metadata,showstain:this.props.showstain},e.SpecimenUID)));return(0,p.jsx)(Te.Ay,{style:{overflowY:"auto"},children:t})}}const Fe=qe;var ze=i(9933),Be=i(1966),We=i(6191),Ye=i(2692);class He extends n.Component{constructor(e){super(e),this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.handleOpacityChange=this.handleOpacityChange.bind(this),this.handleLimitChange=this.handleLimitChange.bind(this),this.handleLowerLimitChange=this.handleLowerLimitChange.bind(this),this.handleUpperLimitChange=this.handleUpperLimitChange.bind(this),this.handleColorRChange=this.handleColorRChange.bind(this),this.handleColorGChange=this.handleColorGChange.bind(this),this.handleColorBChange=this.handleColorBChange.bind(this),this.handleRemoval=this.handleRemoval.bind(this),this.getCurrentColors=this.getCurrentColors.bind(this),this.state={isVisible:this.props.isVisible,currentStyle:{opacity:this.props.defaultStyle.opacity,color:this.props.defaultStyle.color,paletteColorLookupTable:this.props.defaultStyle.paletteColorLookupTable,limitValues:this.props.defaultStyle.limitValues}}}componentDidUpdate(e,t){this.props.defaultStyle!==e.defaultStyle&&this.setState({currentStyle:this.props.defaultStyle})}handleVisibilityChange(e,t){const i=this.props.opticalPath.identifier;this.setState({isVisible:e}),this.props.onVisibilityChange({opticalPathIdentifier:i,isVisible:e})}handleOpacityChange(e){if(null!=e){const t=this.props.opticalPath.identifier;this.props.onStyleChange({opticalPathIdentifier:t,styleOptions:{opacity:e}}),this.setState((t=>({currentStyle:{color:t.currentStyle.color,paletteColorLookupTable:t.currentStyle.paletteColorLookupTable,opacity:e,limitValues:t.currentStyle.limitValues}})))}}handleColorRChange(e){const t=this.props.opticalPath.identifier;if(null!=e&&void 0!==this.state.currentStyle.color){const i=[Array.isArray(e)?e[0]:e,this.state.currentStyle.color[1],this.state.currentStyle.color[2]];this.setState((e=>({currentStyle:{color:i,paletteColorLookupTable:e.currentStyle.paletteColorLookupTable,opacity:e.currentStyle.opacity,limitValues:e.currentStyle.limitValues}}))),this.props.onStyleChange({opticalPathIdentifier:t,styleOptions:{color:i}})}}handleColorGChange(e){const t=this.props.opticalPath.identifier;if(null!=e&&void 0!==this.state.currentStyle.color){const i=[this.state.currentStyle.color[0],Array.isArray(e)?e[0]:e,this.state.currentStyle.color[2]];this.setState((e=>({currentStyle:{color:i,paletteColorLookupTable:e.currentStyle.paletteColorLookupTable,opacity:e.currentStyle.opacity,limitValues:e.currentStyle.limitValues}}))),this.props.onStyleChange({opticalPathIdentifier:t,styleOptions:{color:i}})}}handleColorBChange(e){const t=this.props.opticalPath.identifier;if(null!=e&&void 0!==this.state.currentStyle.color){const i=[this.state.currentStyle.color[0],this.state.currentStyle.color[1],Array.isArray(e)?e[0]:e];this.setState((e=>({currentStyle:{color:i,paletteColorLookupTable:e.currentStyle.paletteColorLookupTable,opacity:e.currentStyle.opacity,limitValues:e.currentStyle.limitValues}}))),this.props.onStyleChange({opticalPathIdentifier:t,styleOptions:{color:i}})}}getCurrentColors(){const e=e=>"#"+(16777216+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1);if(null!=this.props.defaultStyle.paletteColorLookupTable){return this.props.defaultStyle.paletteColorLookupTable.data.map((t=>e(t)))}return null!=this.state.currentStyle.color?["#000000",e(this.state.currentStyle.color)]:["white","white"]}handleLowerLimitChange(e){const t=this.props.opticalPath.identifier;null!=e&&void 0!==this.state.currentStyle.limitValues&&(this.setState((t=>void 0!==t.currentStyle.limitValues?{currentStyle:{color:t.currentStyle.color,paletteColorLookupTable:t.currentStyle.paletteColorLookupTable,opacity:t.currentStyle.opacity,limitValues:[e,t.currentStyle.limitValues[1]]}}:{currentStyle:{color:t.currentStyle.color,paletteColorLookupTable:t.currentStyle.paletteColorLookupTable,opacity:t.currentStyle.opacity,limitValues:t.currentStyle.limitValues}})),this.props.onStyleChange({opticalPathIdentifier:t,styleOptions:{limitValues:[e,this.state.currentStyle.limitValues[1]]}}))}handleUpperLimitChange(e){const t=this.props.opticalPath.identifier;null!=e&&void 0!==this.state.currentStyle.limitValues&&(this.setState((t=>void 0!==t.currentStyle.limitValues?{currentStyle:{color:t.currentStyle.color,paletteColorLookupTable:t.currentStyle.paletteColorLookupTable,opacity:t.currentStyle.opacity,limitValues:[t.currentStyle.limitValues[0],e]}}:{currentStyle:{color:t.currentStyle.color,paletteColorLookupTable:t.currentStyle.paletteColorLookupTable,opacity:t.currentStyle.opacity,limitValues:t.currentStyle.limitValues}})),this.props.onStyleChange({opticalPathIdentifier:t,styleOptions:{limitValues:[this.state.currentStyle.limitValues[0],e]}}))}handleLimitChange(e){const t=this.props.opticalPath.identifier;this.setState((t=>({currentStyle:{color:t.currentStyle.color,paletteColorLookupTable:t.currentStyle.paletteColorLookupTable,opacity:t.currentStyle.opacity,limitValues:e}}))),this.props.onStyleChange({opticalPathIdentifier:t,styleOptions:{limitValues:e}})}handleRemoval(){const e=this.props.opticalPath.identifier;this.props.onRemoval(e)}render(){var e;const t=this.props.opticalPath.identifier,i=this.props.opticalPath.description,n=[];void 0!==this.props.opticalPath.illuminationWaveLength&&n.push({name:"Illumination wavelength",value:`${this.props.opticalPath.illuminationWaveLength} nm`}),void 0!==this.props.opticalPath.illuminationColor&&n.push({name:"Illumination color",value:this.props.opticalPath.illuminationColor.CodeMeaning});const s=null!==(e=this.props.metadata[0].SpecimenDescriptionSequence)&&void 0!==e?e:[];try{s.forEach((e=>{var t;(null!==(t=e.SpecimenPreparationSequence)&&void 0!==t?t:[]).forEach(((e,t)=>{e.SpecimenPreparationStepContentItemSequence.forEach(((e,t)=>{const i=new de.sr.coding.CodedConcept({value:e.ConceptNameCodeSequence[0].CodeValue,schemeDesignator:e.ConceptNameCodeSequence[0].CodingSchemeDesignator,meaning:e.ConceptNameCodeSequence[0].CodeMeaning});if(e.ValueType===de.sr.valueTypes.ValueTypes.CODE){const t=new de.sr.coding.CodedConcept({value:e.ConceptCodeSequence[0].CodeValue,schemeDesignator:e.ConceptCodeSequence[0].CodingSchemeDesignator,meaning:e.ConceptCodeSequence[0].CodeMeaning});i.equals(Ne.PROCESSING_TYPE)||i.equals(Ne.STAIN)&&n.push({name:"Tissue stain",value:t.CodeMeaning})}else e.ValueType===de.sr.valueTypes.ValueTypes.TEXT&&(i.equals(Ne.PROCESSING_TYPE)||i.equals(Ne.STAIN)&&n.push({name:"Tissue stain",value:e.TextValue}))}))}))}))}catch(b){Y.onError(G,new L(U,b.message))}const o=Math.pow(2,this.props.metadata[0].BitsAllocated)-1,a=null!=i?`${t}: ${i}`:t;let r,l;if(this.props.opticalPath.isMonochromatic){let e,t;e=null!=this.state.currentStyle.color?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(se.A,{plain:!0,children:"Color"}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:5,children:"Red"}),(0,p.jsx)(Se.A,{span:14,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:255,step:1,value:this.state.currentStyle.color[0],onChange:this.handleColorRChange})}),(0,p.jsx)(Se.A,{span:5,children:(0,p.jsx)(ae.A,{min:0,max:255,size:"small",style:{width:"65px"},value:this.state.currentStyle.color[0],onChange:this.handleColorRChange})})]}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:5,children:"Green"}),(0,p.jsx)(Se.A,{span:14,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:255,step:1,value:this.state.currentStyle.color[1],onChange:this.handleColorGChange})}),(0,p.jsx)(Se.A,{span:5,children:(0,p.jsx)(ae.A,{min:0,max:255,size:"small",style:{width:"65px"},value:this.state.currentStyle.color[1],onChange:this.handleColorGChange})})]}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:5,children:"Blue"}),(0,p.jsx)(Se.A,{span:14,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:255,step:1,value:this.state.currentStyle.color[2],onChange:this.handleColorBChange})}),(0,p.jsx)(Se.A,{span:5,children:(0,p.jsx)(ae.A,{min:0,max:255,size:"small",style:{width:"65px"},value:this.state.currentStyle.color[2],onChange:this.handleColorBChange})})]})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(se.A,{plain:!0,children:"Color"}),"Custom pseudo-coloring is disabled because pixels are colorized via a provided palette color lookup table."]}),null!=this.state.currentStyle.limitValues&&(t=(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(se.A,{plain:!0,children:"Values of interest"}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:6,children:(0,p.jsx)(ae.A,{min:0,max:this.state.currentStyle.limitValues[1],size:"small",style:{width:"75px"},value:this.state.currentStyle.limitValues[0],onChange:this.handleLowerLimitChange})}),(0,p.jsx)(Se.A,{span:12,children:(0,p.jsx)(ve.A,{range:!0,min:0,max:o,step:1,value:[this.state.currentStyle.limitValues[0],this.state.currentStyle.limitValues[1]],onChange:this.handleLimitChange})}),(0,p.jsx)(Se.A,{span:6,children:(0,p.jsx)(ae.A,{min:this.state.currentStyle.limitValues[0],max:o,size:"small",style:{width:"75px"},value:this.state.currentStyle.limitValues[1],onChange:this.handleUpperLimitChange})})]})]})),r=(0,p.jsxs)("div",{children:[t,e,(0,p.jsx)(se.A,{plain:!0}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:6,children:"Opacity"}),(0,p.jsx)(Se.A,{span:12,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:1,step:.01,value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})}),(0,p.jsx)(Se.A,{span:6,children:(0,p.jsx)(ae.A,{min:0,max:1,size:"small",step:.1,style:{width:"65px"},value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})})]})]});const i=this.getCurrentColors();l=(0,p.jsx)(Ce.A,{offset:[-20,20],count:" ",style:{borderStyle:"solid",borderWidth:"1px",borderColor:"gray",visibility:this.state.isVisible?"visible":"hidden",backgroundImage:`linear-gradient(to right, ${i.toString()})`},children:(0,p.jsx)(g,{header:a,attributes:n,selectable:!0,hasLongValues:!0})})}else r=(0,p.jsx)("div",{children:(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:6,children:"Opacity"}),(0,p.jsx)(Se.A,{span:12,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:1,step:.01,value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})}),(0,p.jsx)(Se.A,{span:6,children:(0,p.jsx)(ae.A,{min:0,max:1,size:"small",step:.1,style:{width:"60px"},value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})})]})}),l=(0,p.jsx)(g,{header:a,attributes:n,selectable:!0,hasLongValues:!0});const d=[];this.props.isRemovable&&d.push((0,p.jsx)(te.A,{title:"Remove Optical Path",children:(0,p.jsx)(ie.A,{type:"default",shape:"circle",icon:(0,p.jsx)(Be.A,{}),onClick:this.handleRemoval})}));const{defaultStyle:h,isRemovable:u,isVisible:m,metadata:S,onVisibilityChange:v,onStyleChange:y,onRemoval:C,opticalPath:f,...I}=this.props;return(0,p.jsx)(c.A.Item,{style:{height:"100%",paddingLeft:"3px"},...I,children:(0,p.jsxs)(ee.A,{align:"start",children:[(0,p.jsx)("div",{style:{paddingLeft:"14px"},children:(0,p.jsxs)(ee.A,{direction:"vertical",align:"end",children:[(0,p.jsx)(he.A,{size:"small",checked:this.state.isVisible,onChange:this.handleVisibilityChange,checkedChildren:(0,p.jsx)(We.A,{}),unCheckedChildren:(0,p.jsx)(Ye.A,{})}),(0,p.jsx)(ye.A,{placement:"left",content:r,overlayStyle:{width:"350px"},title:"Display Settings",children:(0,p.jsx)(ie.A,{type:"primary",shape:"circle",icon:(0,p.jsx)(fe.A,{})})}),d]})}),l]})},this.props.opticalPath.identifier)}}const Xe=He,{Option:Ke}=J.A;class Qe extends n.Component{constructor(e){super(e),this.state={selectedOpticalPathIdentifier:void 0},this.handleItemAddition=this.handleItemAddition.bind(this),this.handleItemRemoval=this.handleItemRemoval.bind(this),this.handleItemSelectionChange=this.handleItemSelectionChange.bind(this)}handleItemRemoval(e){this.props.onOpticalPathActivityChange({opticalPathIdentifier:e,isActive:!1})}handleItemSelectionChange(e){this.setState({selectedOpticalPathIdentifier:e})}handleItemAddition(){const e=this.state.selectedOpticalPathIdentifier;void 0!==e&&(this.props.onOpticalPathActivityChange({opticalPathIdentifier:e,isActive:!0}),this.setState({selectedOpticalPathIdentifier:void 0}))}render(){if(void 0===this.props.metadata)return null;const e=this.props.opticalPaths.length>1,t=[],i=[];let n;return this.props.opticalPaths.forEach((n=>{const s=n.identifier,o=this.props.metadata[s],a=o[0].SeriesInstanceUID;o[0].OpticalPathSequence.forEach((s=>{const r=s.OpticalPathIdentifier,l=s.OpticalPathDescription;if(n.identifier===r)if(this.props.activeOpticalPathIdentifiers.has(r))t.push((0,p.jsx)(Xe,{opticalPath:n,metadata:o,isVisible:this.props.visibleOpticalPathIdentifiers.has(r),defaultStyle:this.props.defaultOpticalPathStyles[r],onVisibilityChange:this.props.onOpticalPathVisibilityChange,onStyleChange:this.props.onOpticalPathStyleChange,onRemoval:this.handleItemRemoval,isRemovable:e},`${a}-${r}`));else{let e;e=""!==l?`${r} - ${l}`:`${r}`,i.push((0,p.jsx)(Ke,{value:r,children:e},r))}}))})),e&&(n=(0,p.jsxs)(ee.A,{align:"center",size:20,style:{padding:"14px"},children:[(0,p.jsx)(J.A,{defaultValue:"",style:{width:200},onChange:this.handleItemSelectionChange,value:this.state.selectedOpticalPathIdentifier,allowClear:!0,children:i}),(0,p.jsx)(te.A,{title:"Add",children:(0,p.jsx)(ie.A,{icon:(0,p.jsx)(ze.A,{}),type:"primary",onClick:this.handleItemAddition})})]})),(0,p.jsxs)(c.A,{selectable:!1,children:[t,n]})}}const Je=Qe;class Ze extends n.Component{constructor(e){super(e),this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.handleOpacityChange=this.handleOpacityChange.bind(this),this.state={isVisible:this.props.isVisible,currentStyle:{opacity:this.props.defaultStyle.opacity}}}handleVisibilityChange(e,t){this.props.onVisibilityChange({mappingUID:this.props.mapping.uid,isVisible:e}),this.setState({isVisible:e})}handleOpacityChange(e){null!=e&&(this.props.onStyleChange({mappingUID:this.props.mapping.uid,styleOptions:{opacity:e}}),this.setState((t=>({currentStyle:{opacity:e}}))))}render(){const e=[{name:"Description",value:this.props.mapping.description}],t=(0,p.jsx)("div",{children:(0,p.jsxs)(ne.A,{justify:"center",align:"middle",children:[(0,p.jsx)(Se.A,{span:6,children:"Opacity"}),(0,p.jsx)(Se.A,{span:12,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:1,step:.01,value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})}),(0,p.jsx)(Se.A,{span:6,children:(0,p.jsx)(ae.A,{min:0,max:1,size:"small",step:.1,style:{width:"65px"},value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})})]})}),{defaultStyle:i,isVisible:n,mapping:s,metadata:o,onVisibilityChange:a,onStyleChange:r,...d}=this.props;return(0,p.jsx)(c.A.Item,{style:{height:"100%",paddingLeft:"3px"},...d,children:(0,p.jsxs)(ee.A,{align:"start",children:[(0,p.jsx)("div",{style:{paddingLeft:"14px"},children:(0,p.jsx)(ee.A,{direction:"vertical",align:"end",size:100,children:(0,p.jsxs)(ee.A,{direction:"vertical",align:"end",children:[(0,p.jsx)(he.A,{size:"small",onChange:this.handleVisibilityChange,checked:this.props.isVisible,checkedChildren:(0,p.jsx)(l.Ny1,{}),unCheckedChildren:(0,p.jsx)(l.mx3,{})}),(0,p.jsx)(ye.A,{placement:"left",content:t,overlayStyle:{width:"350px"},title:"Display Settings",children:(0,p.jsx)(ie.A,{type:"primary",shape:"circle",icon:(0,p.jsx)(fe.A,{})})})]})})}),(0,p.jsx)(g,{header:this.props.mapping.label,attributes:e,selectable:!0,hasLongValues:!0})]})},this.props.mapping.uid)}}const et=Ze;class tt extends n.Component{render(){const e=this.props.mappings.map(((e,t)=>{const i=e.uid;return(0,p.jsx)(et,{mapping:e,metadata:this.props.metadata[i],isVisible:this.props.visibleMappingUIDs.has(i),defaultStyle:this.props.defaultMappingStyles[i],onVisibilityChange:this.props.onMappingVisibilityChange,onStyleChange:this.props.onMappingStyleChange},e.uid)}));return(0,p.jsx)(c.A,{selectable:!1,children:e})}}const it=tt;class nt extends n.Component{constructor(e){super(e),this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.handleOpacityChange=this.handleOpacityChange.bind(this),this.state={isVisible:this.props.isVisible,currentStyle:{opacity:this.props.defaultStyle.opacity}}}handleVisibilityChange(e,t){this.props.onVisibilityChange({segmentUID:this.props.segment.uid,isVisible:e}),this.setState({isVisible:e})}handleOpacityChange(e){null!=e&&(this.props.onStyleChange({segmentUID:this.props.segment.uid,styleOptions:{opacity:e}}),this.setState({currentStyle:{opacity:e}}))}render(){const e=[{name:"Property Type",value:this.props.segment.propertyType.CodeMeaning},{name:"Property Category",value:this.props.segment.propertyCategory.CodeMeaning},{name:"Algorithm Name",value:this.props.segment.algorithmName}],t=(0,p.jsx)("div",{children:(0,p.jsxs)(ne.A,{justify:"center",align:"middle",children:[(0,p.jsx)(Se.A,{span:6,children:"Opacity"}),(0,p.jsx)(Se.A,{span:12,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:1,step:.01,value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})}),(0,p.jsx)(Se.A,{span:6,children:(0,p.jsx)(ae.A,{min:0,max:1,size:"small",step:.1,style:{width:"65px"},value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})})]})}),{defaultStyle:i,isVisible:n,segment:s,metadata:o,onVisibilityChange:a,onStyleChange:r,...d}=this.props;return(0,p.jsx)(c.A.Item,{style:{height:"100%",paddingLeft:"3px"},...d,children:(0,p.jsxs)(ee.A,{align:"start",children:[(0,p.jsx)("div",{style:{paddingLeft:"14px"},children:(0,p.jsxs)(ee.A,{direction:"vertical",align:"end",children:[(0,p.jsx)(he.A,{size:"small",onChange:this.handleVisibilityChange,checked:this.props.isVisible,checkedChildren:(0,p.jsx)(l.Ny1,{}),unCheckedChildren:(0,p.jsx)(l.mx3,{})}),(0,p.jsx)(ye.A,{placement:"left",content:t,overlayStyle:{width:"350px"},title:"Display Settings",children:(0,p.jsx)(ie.A,{type:"primary",shape:"circle",icon:(0,p.jsx)(fe.A,{})})})]})}),(0,p.jsx)(g,{header:this.props.segment.label,attributes:e,selectable:!0,hasLongValues:!0})]})},this.props.segment.uid)}}const st=nt;class ot extends n.Component{render(){const e=this.props.segments.map(((e,t)=>{const i=e.uid;return(0,p.jsx)(st,{segment:e,metadata:this.props.metadata[i],isVisible:this.props.visibleSegmentUIDs.has(i),defaultStyle:this.props.defaultSegmentStyles[i],onVisibilityChange:this.props.onSegmentVisibilityChange,onStyleChange:this.props.onSegmentStyleChange},e.uid)}));return(0,p.jsx)(c.A,{selectable:!1,children:e})}}const at=ot;function rt(e){return function(t){const i=(0,s.zy)(),n=(0,s.Zp)(),o=(0,s.g)();return(0,p.jsx)(e,{...t,location:i,navigate:n,params:o})}}class lt extends n.Component{constructor(e){super(e),this.handleOpacityChange=this.handleOpacityChange.bind(this),this.handleColorRChange=this.handleColorRChange.bind(this),this.handleColorGChange=this.handleColorGChange.bind(this),this.handleColorBChange=this.handleColorBChange.bind(this),this.getCurrentColor=this.getCurrentColor.bind(this),this.state={currentStyle:{opacity:this.props.defaultStyle.opacity,color:this.props.defaultStyle.color}}}handleOpacityChange(e){null!=e&&(this.props.annotationGroupsUIDs.forEach((t=>{this.props.onStyleChange({uid:t,styleOptions:{color:this.state.currentStyle.color,opacity:e}})})),this.setState({currentStyle:{opacity:e,color:this.state.currentStyle.color}}))}handleColorRChange(e){if(null!=e&&void 0!==this.state.currentStyle.color){const t=[Array.isArray(e)?e[0]:e,this.state.currentStyle.color[1],this.state.currentStyle.color[2]];this.setState((e=>({currentStyle:{color:t,opacity:e.currentStyle.opacity}}))),this.props.annotationGroupsUIDs.forEach((e=>{this.props.onStyleChange({uid:e,styleOptions:{color:t,opacity:this.state.currentStyle.opacity}})}))}}handleColorGChange(e){if(null!=e&&void 0!==this.state.currentStyle.color){const t=[this.state.currentStyle.color[0],Array.isArray(e)?e[0]:e,this.state.currentStyle.color[2]];this.setState((e=>({currentStyle:{color:t,opacity:e.currentStyle.opacity}}))),this.props.annotationGroupsUIDs.forEach((e=>{this.props.onStyleChange({uid:e,styleOptions:{color:t,opacity:this.state.currentStyle.opacity}})}))}}handleColorBChange(e){if(null!=e&&void 0!==this.state.currentStyle.color){const t=[this.state.currentStyle.color[0],this.state.currentStyle.color[1],Array.isArray(e)?e[0]:e];this.setState((e=>({currentStyle:{color:t,opacity:e.currentStyle.opacity}}))),this.props.annotationGroupsUIDs.forEach((e=>{this.props.onStyleChange({uid:e,styleOptions:{color:t,opacity:this.state.currentStyle.opacity}})}))}}getCurrentColor(){return null!=this.state.currentStyle.color?"#"+(16777216+((e=this.state.currentStyle.color)[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1):"white";var e}render(){let e;return null!=this.state.currentStyle.color&&(e=(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(se.A,{plain:!0,children:"Color"}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:5,children:"Red"}),(0,p.jsx)(Se.A,{span:14,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:255,step:1,value:this.state.currentStyle.color[0],onChange:this.handleColorRChange})}),(0,p.jsx)(Se.A,{span:5,children:(0,p.jsx)(ae.A,{min:0,max:255,size:"small",style:{width:"65px"},value:this.state.currentStyle.color[0],onChange:this.handleColorRChange})})]}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:5,children:"Green"}),(0,p.jsx)(Se.A,{span:14,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:255,step:1,value:this.state.currentStyle.color[1],onChange:this.handleColorGChange})}),(0,p.jsx)(Se.A,{span:5,children:(0,p.jsx)(ae.A,{min:0,max:255,size:"small",style:{width:"65px"},value:this.state.currentStyle.color[1],onChange:this.handleColorGChange})})]}),(0,p.jsxs)(ne.A,{justify:"center",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:5,children:"Blue"}),(0,p.jsx)(Se.A,{span:14,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:255,step:1,value:this.state.currentStyle.color[2],onChange:this.handleColorBChange})}),(0,p.jsx)(Se.A,{span:5,children:(0,p.jsx)(ae.A,{min:0,max:255,size:"small",style:{width:"65px"},value:this.state.currentStyle.color[2],onChange:this.handleColorBChange})})]}),(0,p.jsx)(se.A,{plain:!0})]})),(0,p.jsxs)("div",{children:[e,(0,p.jsxs)(ne.A,{justify:"start",align:"middle",gutter:[8,8],children:[(0,p.jsx)(Se.A,{span:6,children:"Opacity"}),(0,p.jsx)(Se.A,{span:12,children:(0,p.jsx)(ve.A,{range:!1,min:0,max:1,step:.01,value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})}),(0,p.jsx)(Se.A,{span:6,children:(0,p.jsx)(ae.A,{min:0,max:1,size:"small",step:.1,style:{width:"65px"},value:this.state.currentStyle.opacity,onChange:this.handleOpacityChange})})]})]})}}const ct=lt,dt=e=>{let{category:t,onChange:i,checkedAnnotationUids:n,onStyleChange:s,defaultAnnotationStyles:o}=e;const{types:a}=t,r=a.every((e=>e.uids.every((e=>n.has(e))))),l=!r&&a.some((e=>e.uids.some((e=>n.has(e))))),d=e=>{let{type:t,isVisible:n}=e;t.uids.forEach((e=>{i({roiUID:e,isVisible:n})}))};return(0,p.jsx)(c.A.Item,{style:{height:"100%",paddingLeft:"3px"},children:(0,p.jsx)(ee.A,{align:"start",children:(0,p.jsxs)("div",{style:{paddingLeft:"14px",color:"black"},children:[(0,p.jsx)(ee.A,{direction:"vertical",align:"end",children:(0,p.jsxs)(Z.A,{indeterminate:l,checked:r,onChange:e=>{const t=e.target.checked;a.forEach((e=>{d({type:e,isVisible:t})}))},children:[(0,p.jsx)(te.A,{title:`${t.CodeValue}:${t.CodingSchemeDesignator}`,mouseEnterDelay:1,children:t.CodeMeaning}),(0,p.jsx)(ye.A,{placement:"topLeft",overlayStyle:{width:"350px"},title:"Display Settings",content:()=>(0,p.jsx)(ct,{annotationGroupsUIDs:a.reduce(((e,t)=>[...e,...t.uids]),[]),onStyleChange:s,defaultStyle:o[a[0].uids[0]]}),children:(0,p.jsx)(ie.A,{type:"primary",shape:"circle",style:{marginLeft:"10px"},icon:(0,p.jsx)(fe.A,{})})})]})}),a.map((e=>{const{CodeMeaning:t,CodingSchemeDesignator:i,CodeValue:a,uids:r}=e,l=t.slice(0,22),c=l===t?t:`${l}...`,h=r.every((e=>n.has(e))),u=!h&&r.some((e=>n.has(e)));return(0,p.jsxs)("div",{style:{paddingLeft:"25px",width:"100%",display:"flex",flexDirection:"row"},children:[(0,p.jsx)(Z.A,{indeterminate:u,checked:h,onChange:t=>d({type:e,isVisible:t.target.checked})}),(0,p.jsxs)("div",{style:{paddingLeft:"5px"},children:[(0,p.jsx)(te.A,{title:`${a}:${i}`,mouseEnterDelay:1,children:c}),(0,p.jsx)(ye.A,{placement:"topLeft",overlayStyle:{width:"350px"},title:"Display Settings",content:()=>(0,p.jsx)(ct,{annotationGroupsUIDs:e.uids,onStyleChange:s,defaultStyle:o[e.uids[0]]}),children:(0,p.jsx)(ie.A,{type:"primary",shape:"circle",style:{marginLeft:"10px"},icon:(0,p.jsx)(fe.A,{})})})]})]},`${e.CodingSchemeDesignator}:${e.CodeMeaning}`)}))]})})},t.CodeMeaning)},ht=e=>{let{annotations:t,onChange:i,onStyleChange:n,defaultAnnotationStyles:s,checkedAnnotationUids:o}=e;const a=(e=>{const t=null===e||void 0===e?void 0:e.reduce(((e,t)=>{var i,n;const{category:s,type:o,uid:a}=t,r=s.CodeMeaning,l=o.CodeMeaning,c=null!==(i=e[r])&&void 0!==i?i:{...s,types:{}},d=null!==(n=c.types[l])&&void 0!==n?n:{...o,uids:[]};return{...e,[r]:{...c,types:{...c.types,[l]:{...d,uids:[...d.uids,a]}}}}}),{});return Object.keys(t).forEach((e=>{const i=t[e],{types:n}=i,s=Object.keys(n).map((e=>n[e]));t[e].types=s})),t})(t);if(0===Object.keys(a).length)return(0,p.jsx)(p.Fragment,{});const r=Object.keys(a).map((e=>{const t=a[e];return(0,p.jsx)(dt,{category:t,onChange:i,onStyleChange:n,defaultAnnotationStyles:s,checkedAnnotationUids:o},t.CodeMeaning)}));return(0,p.jsx)(c.A,{selectable:!1,children:r})},ut=e=>{let{xPosition:t,yPosition:i,attributes:n}=e;return(0,p.jsx)("div",{style:{position:"fixed",top:`${i}px`,left:`${t}px`,backgroundColor:"rgba(230, 230, 230, 0.65)",minWidth:"150px",minHeight:"60px",padding:"20px",fontWeight:"bold",pointerEvents:"none"},children:n.map((e=>(0,p.jsxs)("div",{children:[e.name,": ",(0,p.jsx)("span",{style:{fontWeight:500},children:e.value})]},e.name)))})},pt=[255,234,0],mt=[255,234,0,.2],gt=[0,0,0],St=[[54,162,235],[181,65,98],[75,192,192],[255,158,64],[153,102,254],[255,205,86],[200,203,207]],vt=e=>`${e.CodingSchemeDesignator}-${e.CodeValue}`,yt=e=>{const t=je({content:e.evaluations,name:new de.sr.coding.CodedConcept({value:"121071",meaning:"Finding",schemeDesignator:"DCM"})});if(0===t.length)return void console.warn(`no finding found for ROI ${e.uid}`);const i=t[0].ConceptCodeSequence[0];return vt(i)},Ct=e=>{const t={color:pt,width:2};null!=e.stroke&&(null!=e.stroke.color&&(t.color=e.stroke.color),null!=e.stroke.width&&(t.width=e.stroke.width));const i={color:mt};return null!=e.fill&&null!=e.fill.color&&(i.color=e.fill.color),{stroke:t,fill:i,image:{circle:{radius:null!=e.radius?e.radius:Math.max(5-t.width,1),stroke:t,fill:i}}}},ft=e=>{let{clients:t,slide:i,preload:n}=e;console.info(`instantiate viewer for VOLUME images of slide "${i.volumeImages[0].ContainerIdentifier}"`);try{const e=new D.viewer.VolumeImageViewer({clientMapping:t,metadata:i.volumeImages,controls:["overview","position"],preload:n,errorInterceptor:e=>{Y.onError($,e)}});let s;return e.activateSelectInteraction({}),i.labelImages.length>0&&(console.info(`instantiate viewer for LABEL image of slide "${i.labelImages[0].ContainerIdentifier}"`),s=new D.viewer.LabelImageViewer({client:t[V.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE],metadata:i.labelImages[0],resizeFactor:1,orientation:"vertical",errorInterceptor:e=>{Y.onError($,e)}})),{volumeViewer:e,labelViewer:s}}catch(s){throw Y.onError(q,new L(T,"Failed to instantiate viewer")),s}};class It extends n.Component{constructor(e){super(e),this.findingOptions=[],this.evaluationOptions={},this.measurements=[],this.geometryTypeOptions={},this.volumeViewportRef=void 0,this.labelViewportRef=void 0,this.volumeViewer=void 0,this.labelViewer=void 0,this.defaultRoiStyle={stroke:{color:pt,width:2},fill:{color:mt},image:{circle:{fill:{color:pt},radius:5}}},this.roiStyles={},this.defaultAnnotationStyles={},this.selectionColor=[140,184,198],this.selectedRoiStyle={stroke:{color:[...this.selectionColor,1],width:3},fill:{color:[...this.selectionColor,.2]},image:{circle:{radius:5,fill:{color:[...this.selectionColor,1]}}}},this.loadPresentationStates=()=>{console.info("search for Presentation State instances");const e=this.props.clients[V.ADVANCED_BLENDING_PRESENTATION_STATE];e.searchForInstances({studyInstanceUID:this.props.studyInstanceUID,queryParams:{Modality:"PR"}}).then((t=>{null==t&&(t=[]),t.forEach(((t,i)=>{const{dataset:n}=D.metadata.formatMetadata(t),s=n;console.info(`retrieve PR instance "${s.SOPInstanceUID}"`),e.retrieveInstance({studyInstanceUID:this.props.studyInstanceUID,seriesInstanceUID:s.SeriesInstanceUID,sopInstanceUID:s.SOPInstanceUID}).then((e=>{const t=de.p.DicomMessage.readFile(e),{dataset:n}=D.metadata.formatMetadata(t.dict);if(this.props.slide.areVolumeImagesMonochrome){const e=n;let t=!1;e.AdvancedBlendingSequence.forEach((e=>{t=this.props.slide.seriesInstanceUIDs.includes(e.SeriesInstanceUID)})),t&&(console.info(`include Advanced Blending Presentation State instance "${e.SOPInstanceUID}"`),(0===i&&null==this.props.selectedPresentationStateUID||e.SOPInstanceUID===this.props.selectedPresentationStateUID)&&this.setPresentationState(e),this.setState((t=>{const i={};return t.presentationStates.forEach((e=>{i[e.SOPInstanceUID]=e})),i[e.SOPInstanceUID]=e,{presentationStates:Object.values(i)}})))}else console.info(`ignore presentation state "${s.SOPInstanceUID}", application of presentation states for color images has not (yet) been implemented`)})).catch((e=>{Y.onError(q,new L(T,"Presentation State could not be loaded")),console.error(`failed to load presentation state of SOP instance "${s.SOPInstanceUID}" of series "${s.SeriesInstanceUID}" of study "${this.props.studyInstanceUID}": `,e)}))}))})).catch((e=>{console.error(e),Y.onError(q,new L(T,"Presentation State could not be loaded"))}))},this.setPresentationState=e=>{const t=this.volumeViewer.getAllOpticalPaths();console.info(`apply Presentation State instance "${e.SOPInstanceUID}"`);const i={};t.forEach((t=>{const n=t.identifier;this.volumeViewer.hideOpticalPath(n),this.volumeViewer.deactivateOpticalPath(n);const s=this.volumeViewer.getOpticalPathDefaultStyle(n);this.volumeViewer.setOpticalPathStyle(n,s),e.AdvancedBlendingSequence.forEach((e=>{let s=e.ReferencedInstanceSequence;void 0===s&&(s=e.ReferencedImageSequence),void 0!==s&&s.forEach((s=>{if(t.sopInstanceUIDs.includes(s.ReferencedSOPInstanceUID)){let t,s;if(null!=e.PaletteColorLookupTableSequence){const i=e.PaletteColorLookupTableSequence[0];t=new D.color.PaletteColorLookupTable({uid:null!=i.PaletteColorLookupTableUID?i.PaletteColorLookupTableUID:"",redDescriptor:i.RedPaletteColorLookupTableDescriptor,greenDescriptor:i.GreenPaletteColorLookupTableDescriptor,blueDescriptor:i.BluePaletteColorLookupTableDescriptor,redData:null!=i.RedPaletteColorLookupTableData?new Uint16Array(i.RedPaletteColorLookupTableData):void 0,greenData:null!=i.GreenPaletteColorLookupTableData?new Uint16Array(i.GreenPaletteColorLookupTableData):void 0,blueData:null!=i.BluePaletteColorLookupTableData?new Uint16Array(i.BluePaletteColorLookupTableData):void 0,redSegmentedData:null!=i.SegmentedRedPaletteColorLookupTableData?new Uint16Array(i.SegmentedRedPaletteColorLookupTableData):void 0,greenSegmentedData:null!=i.SegmentedGreenPaletteColorLookupTableData?new Uint16Array(i.SegmentedGreenPaletteColorLookupTableData):void 0,blueSegmentedData:null!=i.SegmentedBluePaletteColorLookupTableData?new Uint16Array(i.SegmentedBluePaletteColorLookupTableData):void 0})}if(null!=e.SoftcopyVOILUTSequence){const t=e.SoftcopyVOILUTSequence[0],i=t.WindowCenter,n=t.WindowWidth;s=[i-.5*n,i+.5*n]}i[n]={opacity:1,paletteColorLookupTable:t,limitValues:s}}}))}))}));const n=new Set;Object.keys(i).forEach((e=>{const t=i[e];null!=t?(this.volumeViewer.setOpticalPathStyle(e,t),this.volumeViewer.activateOpticalPath(e),this.volumeViewer.showOpticalPath(e),n.add(e)):(this.volumeViewer.hideOpticalPath(e),this.volumeViewer.deactivateOpticalPath(e))}));const s=new URLSearchParams(this.props.location.search);s.set("state",e.SOPInstanceUID),this.props.navigate({pathname:this.props.location.pathname,search:s.toString()},{replace:!0}),this.setState((t=>({activeOpticalPathIdentifiers:n,visibleOpticalPathIdentifiers:n,selectedPresentationStateUID:e.SOPInstanceUID})))},this.getRoiStyle=e=>null==e?this.defaultRoiStyle:void 0!==this.roiStyles[e]?this.roiStyles[e]:this.defaultRoiStyle,this.addAnnotations=()=>{console.info("search for Comprehensive 3D SR instances");const e=this.props.clients[V.COMPREHENSIVE_3D_SR];e.searchForInstances({studyInstanceUID:this.props.studyInstanceUID,queryParams:{Modality:"SR"}}).then((t=>{null==t&&(t=[]),t.forEach((t=>{const{dataset:i}=D.metadata.formatMetadata(t),n=i;n.SOPClassUID===V.COMPREHENSIVE_3D_SR&&(console.info(`retrieve SR instance "${n.SOPInstanceUID}"`),e.retrieveInstance({studyInstanceUID:this.props.studyInstanceUID,seriesInstanceUID:n.SeriesInstanceUID,sopInstanceUID:n.SOPInstanceUID}).then((e=>{const t=de.p.DicomMessage.readFile(e),{dataset:i}=D.metadata.formatMetadata(t.dict),n=i;if(!(e=>{const t=e.ContentTemplateSequence;if(t.length>0&&"1500"===t[0].TemplateIdentifier)return!0;return!1})(n))return void console.debug(`ignore SR document "${n.SOPInstanceUID}" because it is not structured according to template TID 1500 "MeasurementReport"`);if(!(e=>{const t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"121024",schemeDesignator:"DCM",meaning:"Subject Class"})});if(0===t.length)return!1;const i=t[0].ConceptCodeSequence[0],n=new de.sr.coding.CodedConcept({value:i.CodeValue,meaning:i.CodeMeaning,schemeDesignator:i.CodingSchemeDesignator}),s=new de.sr.coding.CodedConcept({value:"121027",meaning:"Specimen",schemeDesignator:"DCM"});return!!n.equals(s)})(n))return void console.debug(`ignore SR document "${n.SOPInstanceUID}" because it does not describe a specimen subject`);if(!(e=>{const t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"126010",schemeDesignator:"DCM",meaning:"Imaging Measurements"})});if(0===t.length)return!1;const i=t[0],n=je({content:i.ContentSequence,name:new de.sr.coding.CodedConcept({value:"125007",schemeDesignator:"DCM",meaning:"Measurement Group"})});let s=!1;return n.forEach((e=>{const t=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"111030",schemeDesignator:"DCM",meaning:"Image Region"})});t.length>0&&t[0].ValueType===de.sr.valueTypes.ValueTypes.SCOORD3D&&(s=!0)})),s})(n))return void console.debug(`ignore SR document "${n.SOPInstanceUID}" because it does not contain any suitable ROI annotations`);new Pe(n).ROIs.forEach((e=>{console.info(`add ROI "${e.uid}"`);const t=e.scoord3d,i=this.props.slide.volumeImages[0];if(t.frameOfReferenceUID===i.FrameOfReferenceUID){const t=this.volumeViewer.getAllROIs().some((t=>((e,t)=>{if(e.scoord3d.graphicType!==t.scoord3d.graphicType)return!1;if(e.scoord3d.frameOfReferenceUID!==t.scoord3d.frameOfReferenceUID)return!1;if(e.scoord3d.graphicData.length!==t.scoord3d.graphicData.length)return!1;for(let i=0;i<e.scoord3d.graphicData.length;++i)if("POINT"===e.scoord3d.graphicType){const n=e.scoord3d,s=t.scoord3d;if(n.graphicData[i].toPrecision(6)!==s.graphicData[i].toPrecision(6))return!1}else{const n=e.scoord3d,s=t.scoord3d;for(let e=0;e<n.graphicData[i].length;++e)if(n.graphicData[i][e].toPrecision(6)!==s.graphicData[i][e].toPrecision(6))return!1}return!0})(t,e)));if(t)console.debug(`skip already existing ROI "${e.uid}"`);else try{this.volumeViewer.addROI(e,{})}catch{console.error(`could not add ROI "${e.uid}"`)}}else console.debug(`skip ROI "${e.uid}" of SR document "${n.SOPInstanceUID}"because it is defined in another frame of reference`)}))})).catch((e=>{Y.onError(q,new L(T,"Annotations could not be loaded")),console.error(`failed to load ROIs of SOP instance "${n.SOPInstanceUID}" of series "${n.SeriesInstanceUID}" of study "${this.props.studyInstanceUID}": `,e)})),this.forceUpdate())}))})).catch((e=>{console.error(e),Y.onError(q,new L(T,"Annotations could not be loaded"))}))},this.addAnnotationGroups=()=>{console.info("search for Microscopy Bulk Simple Annotations instances");const e=this.props.clients[V.MICROSCOPY_BULK_SIMPLE_ANNOTATION];e.searchForSeries({studyInstanceUID:this.props.studyInstanceUID,queryParams:{Modality:"ANN"}}).then((t=>{null==t&&(t=[]),t.forEach((t=>{const{dataset:i}=D.metadata.formatMetadata(t),n=i;e.retrieveSeriesMetadata({studyInstanceUID:this.props.studyInstanceUID,seriesInstanceUID:n.SeriesInstanceUID}).then((e=>{e.map((e=>new D.metadata.MicroscopyBulkSimpleAnnotations({metadata:e}))).forEach((e=>{try{this.volumeViewer.addAnnotationGroups(e)}catch(t){Y.onError(q,new L(T,"Microscopy Bulk Simple Annotations cannot be displayed.")),console.error("failed to add annotation groups:",t)}e.AnnotationGroupSequence.forEach((e=>{const t=e.AnnotationGroupUID,i=e.AnnotationPropertyTypeCodeSequence[0],n=vt(i),s=this.roiStyles[n];null!=s&&null!=s.fill&&this.volumeViewer.setAnnotationGroupStyle(t,{color:s.fill.color})}))})),this.forceUpdate()})).catch((e=>{console.error(e),Y.onError(q,new L(T,"Retrieval of metadata of Microscopy Bulk Simple Annotations instances failed."))}))}))})).catch((e=>{console.error(e),Y.onError(q,new L(T,"Search for Microscopy Bulk Simple Annotations instances failed."))}))},this.addSegmentations=()=>{console.info("search for Segmentation instances");const e=this.props.clients[V.SEGMENTATION];e.searchForSeries({studyInstanceUID:this.props.studyInstanceUID,queryParams:{Modality:"SEG"}}).then((t=>{null==t&&(t=[]),t.forEach(((t,i)=>{const{dataset:n}=D.metadata.formatMetadata(t),s=n;e.retrieveSeriesMetadata({studyInstanceUID:this.props.studyInstanceUID,seriesInstanceUID:s.SeriesInstanceUID}).then((e=>{const t=[];if(e.forEach((e=>{const i=new D.metadata.Segmentation({metadata:e}),n=this.props.slide.volumeImages[0];i.FrameOfReferenceUID===n.FrameOfReferenceUID&&i.ContainerIdentifier===n.ContainerIdentifier&&t.push(i)})),t.length>0){try{this.volumeViewer.addSegments(t)}catch(i){Y.onError(q,new L(T,"Segmentations cannot be displayed")),console.error("failed to add segments: ",i)}this.forceUpdate()}})).catch((e=>{console.error(e),Y.onError(q,new L(T,"Retrieval of metadata of Segmentation instances failed."))}))}))})).catch((e=>{console.error(e),Y.onError(q,new L(T,"Search for Segmentation instances failed."))}))},this.addParametricMaps=()=>{console.info("search for Parametric Map instances");const e=this.props.clients[V.PARAMETRIC_MAP];e.searchForSeries({studyInstanceUID:this.props.studyInstanceUID,queryParams:{Modality:"OT"}}).then((t=>{null==t&&(t=[]),t.forEach((t=>{const{dataset:i}=D.metadata.formatMetadata(t),n=i;e.retrieveSeriesMetadata({studyInstanceUID:this.props.studyInstanceUID,seriesInstanceUID:n.SeriesInstanceUID}).then((e=>{const t=[];if(e.forEach((e=>{const i=new D.metadata.ParametricMap({metadata:e}),n=this.props.slide.volumeImages[0];i.FrameOfReferenceUID===n.FrameOfReferenceUID&&i.ContainerIdentifier===n.ContainerIdentifier?t.push(i):console.warn(`skip Parametric Map instance "${i.SOPInstanceUID}"`)})),t.length>0){try{this.volumeViewer.addParameterMappings(t)}catch(i){Y.onError(q,new L(T,"Parametric Map cannot be displayed")),console.error("failed to add mappings: ",i)}this.forceUpdate()}})).catch((e=>{console.error(e),Y.onError(q,new L(T,"Retrieval of metadata of Parametric Map instances failed."))}))}))})).catch((e=>{console.error(e),Y.onError(q,new L(T,"Search for Parametric Map instances failed."))}))},this.populateViewports=()=>{console.info("populate viewports..."),this.setState({isLoading:!0,presentationStates:[]}),null!=this.volumeViewportRef.current&&this.volumeViewer.render({container:this.volumeViewportRef.current}),null!=this.labelViewportRef.current&&null!=this.labelViewer&&this.labelViewer.render({container:this.labelViewportRef.current}),this.setState({isLoading:!1}),this.setDefaultPresentationState(),this.loadPresentationStates(),this.addAnnotations(),this.addAnnotationGroups(),this.addSegmentations(),this.addParametricMaps()},this.onRoiModified=e=>{this.setState((e=>({visibleRoiUIDs:new Set(e.visibleRoiUIDs)})))},this.onWindowResize=e=>{console.info("resize viewports"),this.volumeViewer.resize(),null!=this.labelViewer&&this.labelViewer.resize()},this.onRoiDrawn=e=>{const t=e.detail.payload,i=this.state.selectedFinding,n=this.state.selectedEvaluations;if(void 0!==t&&void 0!==i){console.debug(`add ROI "${t.uid}"`);const e=new de.sr.valueTypes.CodeContentItem({name:new de.sr.coding.CodedConcept({value:"121071",meaning:"Finding",schemeDesignator:"DCM"}),value:i,relationshipType:"CONTAINS"});t.addEvaluation(e),n.forEach((e=>{const i=new de.sr.valueTypes.CodeContentItem({name:e.name,value:e.value,relationshipType:"CONTAINS"});t.addEvaluation(i)}));const s=vt(i),o=this.getRoiStyle(s);this.volumeViewer.addROI(t,o),this.setState((e=>{const i=e.visibleRoiUIDs;return i.add(t.uid),{visibleRoiUIDs:i}}))}else console.debug(`could not add ROI "${t.uid}"`)},this.onRoiDoubleClicked=e=>{null!=e.detail.payload?this.setState({isSelectedRoiModalVisible:!0}):this.setState({isSelectedRoiModalVisible:!1})},this.setHoveredRoiAttributes=e=>{const t=[];e.evaluations.forEach((e=>{const i=e.ConceptNameCodeSequence[0].CodeValue,n=`${e.ConceptNameCodeSequence[0].CodeMeaning}`;if(e.ValueType===de.sr.valueTypes.ValueTypes.CODE){const s=e.ConceptCodeSequence[0].CodeMeaning;"276214006"===i?t.push({name:"Property category",value:`${s}`}):"121071"===i?t.push({name:"Property type",value:`${s}`}):"111001"===i?t.push({name:"Algorithm Name",value:`${s}`}):t.push({name:n,value:`${s}`})}else if(e.ValueType===de.sr.valueTypes.ValueTypes.TEXT){const i=e;t.push({name:n,value:i.TextValue})}})),this.setState({hoveredRoiAttributes:t})},this.onPointerMove=e=>{const{feature:t,event:i}=e.detail.payload;if(null!=t){const e=i.originalEvent;this.setHoveredRoiAttributes(t),this.setState({isHoveredRoiTooltipVisible:!0,hoveredRoi:t,hoveredRoiTooltipX:e.clientX,hoveredRoiTooltipY:e.clientY})}else this.setState({isHoveredRoiTooltipVisible:!1})},this.onRoiSelected=e=>{const t=e.detail.payload;if(null!=t){console.debug(`selected ROI "${t.uid}"`),this.volumeViewer.setROIStyle(t.uid,this.selectedRoiStyle);const e=yt(t);this.volumeViewer.getAllROIs().forEach((i=>{i.uid!==t.uid&&this.volumeViewer.setROIStyle(i.uid,this.getRoiStyle(e))})),this.setState({selectedRoiUIDs:new Set([t.uid]),selectedRoi:t})}else this.setState({selectedRoiUIDs:new Set,selectedRoi:void 0})},this.onLoadingStarted=e=>{this.setState({isLoading:!0})},this.onLoadingEnded=e=>{this.setState({isLoading:!1})},this.onFrameLoadingStarted=e=>{const t=e.detail.payload,i=`${t.sopInstanceUID}-${t.frameNumber}`;this.setState((e=>(e.loadingFrames.add(i),e)))},this.onFrameLoadingError=e=>{console.error("Failed to load frame")},this.onLoadingError=e=>{var t,i,n,s;console.error("Failed to load data");const o=null===(null===(t=e.detail)||void 0===t||null===(i=t.payload)||void 0===i?void 0:i.message)?"Failed to load data":null===(n=e.detail)||void 0===n||null===(s=n.payload)||void 0===s?void 0:s.message;Y.onError(q,new L(T,o))},this.onFrameLoadingEnded=e=>{const t=e.detail.payload,i=`${t.sopInstanceUID}-${t.frameNumber}`;if(this.setState((e=>{e.loadingFrames.delete(i);let t=!1;return e.loadingFrames.size>0&&(t=!0),{isLoading:t,loadingFrames:e.loadingFrames}})),t.sopClassUID===V.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE&&this.props.slide.areVolumeImagesMonochrome){const e=t.channelIdentifier;if(!(e in this.state.pixelDataStatistics)&&null!=t.pixelArray){const i=65536,n=Math.ceil(t.pixelArray.length/i);let s=0;const o=[],a=[];for(let e=0;e<n;e++){s=e*i;const n=t.pixelArray.slice(s,s+i);o.push(Math.min(...n)),a.push(Math.max(...n))}const r=Math.min(...o),l=Math.max(...a);this.setState((t=>{const i=t.pixelDataStatistics;if(null!=i[e]?i[e]={min:Math.min(i[e].min,r),max:Math.max(i[e].max,l),numFramesSampled:i[e].numFramesSampled+1}:i[e]={min:r,max:l,numFramesSampled:1},null==t.selectedPresentationStateUID){const t={...this.volumeViewer.getOpticalPathStyle(e)};t.limitValues=[i[e].min,i[e].max],this.volumeViewer.setOpticalPathStyle(e,t)}return t}))}}},this.onRoiRemoved=e=>{const t=e.detail.payload;console.debug(`removed ROI "${t.uid}"`)},this.onKeyUp=e=>{"Escape"===e.key?(this.state.isRoiDrawingActive?(console.info("deactivate drawing of ROIs"),this.volumeViewer.deactivateDrawInteraction(),this.volumeViewer.activateSelectInteraction({})):this.state.isRoiModificationActive?(console.info("deactivate modification of ROIs"),this.volumeViewer.deactivateModifyInteraction(),this.volumeViewer.activateSelectInteraction({})):this.state.isRoiTranslationActive&&(console.info("deactivate modification of ROIs"),this.volumeViewer.deactivateTranslateInteraction(),this.volumeViewer.activateSelectInteraction({})),this.setState({isAnnotationModalVisible:!1,isSelectedRoiModalVisible:!1,isRoiTranslationActive:!1,isRoiDrawingActive:!1,isRoiModificationActive:!1,isGoToModalVisible:!1})):e.altKey&&("KeyD"===e.code?this.handleRoiDrawing():"KeyM"===e.code?this.handleRoiModification():"KeyT"===e.code?this.handleRoiTranslation():"KeyR"===e.code?this.handleRoiRemoval():"KeyV"===e.code?this.handleRoiVisibilityChange():"KeyS"===e.code?this.handleReportGeneration():"KeyG"===e.code&&this.handleGoTo())},console.info(`view slide "${this.props.slide.containerIdentifier}": `,this.props.slide);const t=["point","circle","box","polygon","line","freehandpolygon","freehandline"];e.annotations.forEach((e=>{const i=new de.sr.coding.CodedConcept(e.finding);this.findingOptions.push(i);const n=vt(i);void 0!==e.geometryTypes?this.geometryTypeOptions[n]=e.geometryTypes:this.geometryTypeOptions[n]=t,this.evaluationOptions[n]=[],void 0!==e.evaluations&&e.evaluations.forEach((e=>{this.evaluationOptions[n].push({name:new de.sr.coding.CodedConcept(e.name),values:e.values.map((e=>new de.sr.coding.CodedConcept(e)))})})),void 0!==e.measurements&&e.measurements.forEach((e=>{this.measurements.push({name:new de.sr.coding.CodedConcept(e.name),value:void 0,unit:new de.sr.coding.CodedConcept(e.unit)})})),null!=e.style?this.roiStyles[n]=Ct(e.style):this.roiStyles[n]=this.defaultRoiStyle})),this.componentSetup=this.componentSetup.bind(this),this.componentCleanup=this.componentCleanup.bind(this),this.onWindowResize=this.onWindowResize.bind(this),this.handleRoiDrawing=this.handleRoiDrawing.bind(this),this.handleRoiTranslation=this.handleRoiTranslation.bind(this),this.handleRoiModification=this.handleRoiModification.bind(this),this.handleRoiVisibilityChange=this.handleRoiVisibilityChange.bind(this),this.handleRoiRemoval=this.handleRoiRemoval.bind(this),this.handleRoiSelectionCancellation=this.handleRoiSelectionCancellation.bind(this),this.handleAnnotationConfigurationCancellation=this.handleAnnotationConfigurationCancellation.bind(this),this.handleAnnotationGeometryTypeSelection=this.handleAnnotationGeometryTypeSelection.bind(this),this.handleAnnotationMeasurementActivation=this.handleAnnotationMeasurementActivation.bind(this),this.handleAnnotationFindingSelection=this.handleAnnotationFindingSelection.bind(this),this.handleAnnotationEvaluationSelection=this.handleAnnotationEvaluationSelection.bind(this),this.handleAnnotationEvaluationClearance=this.handleAnnotationEvaluationClearance.bind(this),this.handleAnnotationConfigurationCompletion=this.handleAnnotationConfigurationCompletion.bind(this),this.handleAnnotationSelection=this.handleAnnotationSelection.bind(this),this.handleAnnotationVisibilityChange=this.handleAnnotationVisibilityChange.bind(this),this.handleAnnotationGroupVisibilityChange=this.handleAnnotationGroupVisibilityChange.bind(this),this.handleAnnotationGroupStyleChange=this.handleAnnotationGroupStyleChange.bind(this),this.handleRoiStyleChange=this.handleRoiStyleChange.bind(this),this.handleGoTo=this.handleGoTo.bind(this),this.handleXCoordinateSelection=this.handleXCoordinateSelection.bind(this),this.handleYCoordinateSelection=this.handleYCoordinateSelection.bind(this),this.handleMagnificationSelection=this.handleMagnificationSelection.bind(this),this.handleSlidePositionSelection=this.handleSlidePositionSelection.bind(this),this.handleSlidePositionSelectionCancellation=this.handleSlidePositionSelectionCancellation.bind(this),this.handleReportGeneration=this.handleReportGeneration.bind(this),this.handleReportVerification=this.handleReportVerification.bind(this),this.handleReportCancellation=this.handleReportCancellation.bind(this),this.handleSegmentVisibilityChange=this.handleSegmentVisibilityChange.bind(this),this.handleSegmentStyleChange=this.handleSegmentStyleChange.bind(this),this.handleMappingVisibilityChange=this.handleMappingVisibilityChange.bind(this),this.handleMappingStyleChange=this.handleMappingStyleChange.bind(this),this.handleOpticalPathVisibilityChange=this.handleOpticalPathVisibilityChange.bind(this),this.handleOpticalPathStyleChange=this.handleOpticalPathStyleChange.bind(this),this.handleOpticalPathActivityChange=this.handleOpticalPathActivityChange.bind(this),this.handlePresentationStateSelection=this.handlePresentationStateSelection.bind(this),this.handlePresentationStateReset=this.handlePresentationStateReset.bind(this);const{volumeViewer:i,labelViewer:s}=ft({clients:this.props.clients,slide:this.props.slide,preload:this.props.preload});this.volumeViewer=i,this.labelViewer=s,this.volumeViewportRef=n.createRef(),this.labelViewportRef=n.createRef(),this.volumeViewer.getAllOpticalPaths().forEach((e=>{this.volumeViewer.deactivateOpticalPath(e.identifier)}));const[o,a]=this.volumeViewer.boundingBox;this.state={selectedRoiUIDs:new Set,visibleRoiUIDs:new Set,visibleSegmentUIDs:new Set,visibleMappingUIDs:new Set,visibleAnnotationGroupUIDs:new Set,visibleOpticalPathIdentifiers:new Set,activeOpticalPathIdentifiers:new Set,presentationStates:[],selectedFinding:void 0,selectedEvaluations:[],generatedReport:void 0,isLoading:!1,isAnnotationModalVisible:!1,isSelectedRoiModalVisible:!1,isHoveredRoiTooltipVisible:!1,hoveredRoiTooltipX:0,hoveredRoiTooltipY:0,hoveredRoiAttributes:[],isSelectedMagnificationValid:!1,isReportModalVisible:!1,isRoiDrawingActive:!1,isRoiTranslationActive:!1,isRoiModificationActive:!1,isGoToModalVisible:!1,isSelectedXCoordinateValid:!1,isSelectedYCoordinateValid:!1,selectedXCoordinate:void 0,validXCoordinateRange:[o[0],o[0]+a[0]],selectedYCoordinate:void 0,validYCoordinateRange:[o[1],o[1]+a[1]],selectedMagnification:void 0,areRoisHidden:!1,pixelDataStatistics:{},selectedPresentationStateUID:this.props.selectedPresentationStateUID,loadingFrames:new Set}}componentDidUpdate(e,t){if(this.props.location.pathname!==e.location.pathname||this.props.studyInstanceUID!==e.studyInstanceUID||this.props.seriesInstanceUID!==e.seriesInstanceUID||this.props.slide!==e.slide||this.props.clients!==e.clients){null!=this.volumeViewportRef.current&&(this.volumeViewportRef.current.innerHTML=""),this.volumeViewer.cleanup(),null!=this.labelViewer&&(null!=this.labelViewportRef.current&&(this.labelViewportRef.current.innerHTML=""),this.labelViewer.cleanup());const{volumeViewer:e,labelViewer:t}=ft({clients:this.props.clients,slide:this.props.slide,preload:this.props.preload});this.volumeViewer=e,this.labelViewer=t;const i=new Set,n=new Set;this.volumeViewer.getAllOpticalPaths().forEach((e=>{const t=e.identifier;this.volumeViewer.isOpticalPathVisible(t)&&n.add(t),this.volumeViewer.isOpticalPathActive(t)&&i.add(t)}));const[s,o]=this.volumeViewer.boundingBox;this.setState({visibleRoiUIDs:new Set,visibleSegmentUIDs:new Set,visibleMappingUIDs:new Set,visibleAnnotationGroupUIDs:new Set,visibleOpticalPathIdentifiers:n,activeOpticalPathIdentifiers:i,presentationStates:[],loadingFrames:new Set,validXCoordinateRange:[s[0],s[0]+o[0]],validYCoordinateRange:[s[1],s[1]+o[1]]}),this.populateViewports()}}handleRoiSelectionCancellation(){this.setState({isSelectedRoiModalVisible:!1})}componentCleanup(){document.body.removeEventListener("dicommicroscopyviewer_roi_drawn",this.onRoiDrawn),document.body.removeEventListener("dicommicroscopyviewer_roi_selected",this.onRoiSelected),document.body.removeEventListener("dicommicroscopyviewer_roi_double_clicked",this.onRoiDoubleClicked),document.body.removeEventListener("dicommicroscopyviewer_pointer_move",this.onPointerMove),document.body.removeEventListener("dicommicroscopyviewer_roi_removed",this.onRoiRemoved),document.body.removeEventListener("dicommicroscopyviewer_roi_modified",this.onRoiModified),document.body.removeEventListener("dicommicroscopyviewer_loading_started",this.onLoadingStarted),document.body.removeEventListener("dicommicroscopyviewer_loading_ended",this.onLoadingEnded),document.body.removeEventListener("dicommicroscopyviewer_frame_loading_started",this.onFrameLoadingStarted),document.body.removeEventListener("dicommicroscopyviewer_frame_loading_ended",this.onFrameLoadingEnded),document.body.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("resize",this.onWindowResize),this.volumeViewer.cleanup(),null!=this.labelViewer&&this.labelViewer.cleanup()}componentWillUnmount(){this.volumeViewer.cleanup(),null!=this.labelViewer&&this.labelViewer.cleanup(),window.removeEventListener("beforeunload",this.componentCleanup)}componentSetup(){document.body.addEventListener("dicommicroscopyviewer_roi_drawn",this.onRoiDrawn),document.body.addEventListener("dicommicroscopyviewer_roi_selected",this.onRoiSelected),document.body.addEventListener("dicommicroscopyviewer_roi_double_clicked",this.onRoiDoubleClicked),document.body.addEventListener("dicommicroscopyviewer_pointer_move",this.onPointerMove),document.body.addEventListener("dicommicroscopyviewer_roi_removed",this.onRoiRemoved),document.body.addEventListener("dicommicroscopyviewer_roi_modified",this.onRoiModified),document.body.addEventListener("dicommicroscopyviewer_loading_started",this.onLoadingStarted),document.body.addEventListener("dicommicroscopyviewer_loading_ended",this.onLoadingEnded),document.body.addEventListener("dicommicroscopyviewer_loading_error",this.onLoadingError),document.body.addEventListener("dicommicroscopyviewer_frame_loading_started",this.onFrameLoadingStarted),document.body.addEventListener("dicommicroscopyviewer_frame_loading_ended",this.onFrameLoadingEnded),document.body.addEventListener("dicommicroscopyviewer_frame_loading_error",this.onFrameLoadingError),document.body.addEventListener("keyup",this.onKeyUp),window.addEventListener("beforeunload",this.componentCleanup),window.addEventListener("resize",this.onWindowResize)}componentDidMount(){if(this.componentSetup(),this.populateViewports(),!this.props.slide.areVolumeImagesMonochrome){let e=!1;const t=this.props.slide.volumeImages[0];if(null==t.OpticalPathSequence[0].ICCProfile){if("OpticalPathSequence"in t.bulkdataReferences){"ICCProfile"in t.bulkdataReferences.OpticalPathSequence[0]&&(e=!0)}}else e=!0;e||a.Ay.warning("No ICC Profile was found for color images")}}handleAnnotationFindingSelection(e,t){this.findingOptions.forEach((t=>{t.CodeValue===e&&(console.info(`selected finding "${t.CodeMeaning}"`),this.setState({selectedFinding:t,selectedEvaluations:[]}))}))}handleAnnotationGeometryTypeSelection(e,t){this.setState({selectedGeometryType:e})}handleAnnotationMeasurementActivation(e){e.target.checked?this.setState({selectedMarkup:"measurement"}):this.setState({selectedMarkup:void 0})}handleAnnotationEvaluationSelection(e,t){const i=this.state.selectedFinding;if(void 0!==i){const n=vt(i),s=t.label;this.evaluationOptions[n].forEach((t=>{t.name.CodeValue===s.CodeValue&&t.name.CodingSchemeDesignator===s.CodingSchemeDesignator&&t.values.forEach((i=>{if(i.CodeValue===e){const e=this.state.selectedEvaluations.filter((e=>e.name!==t.name));this.setState({selectedEvaluations:[...e,{name:s,value:i}]})}}))}))}}handleAnnotationEvaluationClearance(){this.setState({selectedEvaluations:[]})}handleXCoordinateSelection(e){if(null!=e){const t=Number(e),i=this.state.validXCoordinateRange[0],n=this.state.validXCoordinateRange[1];if(t>=i&&t<=n)return void this.setState({selectedXCoordinate:t,isSelectedXCoordinateValid:!0})}this.setState({selectedXCoordinate:void 0,isSelectedXCoordinateValid:!1})}handleYCoordinateSelection(e){if(null!=e){const t=Number(e),i=this.state.validYCoordinateRange[0],n=this.state.validYCoordinateRange[1];if(t>=i&&t<=n)return void this.setState({selectedYCoordinate:t,isSelectedYCoordinateValid:!0})}this.setState({selectedYCoordinate:void 0,isSelectedYCoordinateValid:!1})}handleMagnificationSelection(e){null!=e&&e>0&&e<=40?this.setState({selectedMagnification:Number(e),isSelectedMagnificationValid:!0}):this.setState({selectedMagnification:void 0,isSelectedMagnificationValid:!1})}handleSlidePositionSelection(){if(this.state.isSelectedXCoordinateValid&&this.state.isSelectedYCoordinateValid&&this.state.isSelectedMagnificationValid&&null!=this.state.selectedXCoordinate&&null!=this.state.selectedYCoordinate&&null!=this.state.selectedMagnification){console.info(`select slide position (${this.state.selectedXCoordinate}, ${this.state.selectedYCoordinate}) at ${this.state.selectedMagnification}x magnification`);const e=.01/this.state.selectedMagnification,t=[];for(let o=0;o<this.volumeViewer.numLevels;o++){const i=this.volumeViewer.getPixelSpacing(o)[0];t.push(Math.abs(e-i))}const i=t.indexOf(Math.min(...t));this.volumeViewer.navigate({position:[this.state.selectedXCoordinate,this.state.selectedYCoordinate],level:i});const n=new D.scoord3d.Point({coordinates:[this.state.selectedXCoordinate,this.state.selectedYCoordinate,0],frameOfReferenceUID:this.volumeViewer.frameOfReferenceUID}),s=new D.roi.ROI({scoord3d:n});this.volumeViewer.addROI(s,this.defaultRoiStyle),this.setState((e=>{const t=e.visibleRoiUIDs;return t.add(s.uid),{visibleRoiUIDs:t,isGoToModalVisible:!1}}))}}handleSlidePositionSelectionCancellation(){console.log("cancel slide position selection"),this.setState({isGoToModalVisible:!1,isSelectedXCoordinateValid:!1,isSelectedYCoordinateValid:!1,isSelectedMagnificationValid:!1,selectedXCoordinate:void 0,selectedYCoordinate:void 0,selectedMagnification:void 0})}handleAnnotationConfigurationCompletion(){console.debug("complete annotation configuration");const e=this.state.selectedFinding,t=this.state.selectedGeometryType,i=this.state.selectedMarkup;void 0!==t&&void 0!==e?(this.volumeViewer.activateDrawInteraction({geometryType:t,markup:i}),this.setState({isAnnotationModalVisible:!1,isRoiDrawingActive:!0})):Y.onError(q,new L(T,"Could not complete annotation configuration"))}handleAnnotationConfigurationCancellation(){console.debug("cancel annotation configuration"),this.setState({isAnnotationModalVisible:!1,isRoiDrawingActive:!1})}handleReportGeneration(){console.info("save ROIs");const e=this.volumeViewer.getAllROIs(),t=this.volumeViewer.getAllOpticalPaths(),i=this.volumeViewer.getOpticalPathMetadata(t[0].identifier),n=i[i.length-1];n.SpecimenDescriptionSequence.length>1&&Y.onError(q,new L(T,"More than one specimen has been described for the slide"));const s=n.SpecimenDescriptionSequence[0];let o;console.debug("create Observation Context"),void 0!==this.props.user?o=new de.sr.templates.PersonObserverIdentifyingAttributes({name:this.props.user.name,loginName:this.props.user.email}):(console.warn("no user information available"),o=new de.sr.templates.PersonObserverIdentifyingAttributes({name:"ANONYMOUS"}));const a=new de.sr.templates.ObservationContext({observerPersonContext:new de.sr.templates.ObserverContext({observerType:new de.sr.coding.CodedConcept({value:"121006",schemeDesignator:"DCM",meaning:"Person"}),observerIdentifyingAttributes:o}),observerDeviceContext:new de.sr.templates.ObserverContext({observerType:new de.sr.coding.CodedConcept({value:"121007",schemeDesignator:"DCM",meaning:"Device"}),observerIdentifyingAttributes:new de.sr.templates.DeviceObserverIdentifyingAttributes({uid:this.props.app.uid,manufacturerName:"MGH Computational Pathology",modelName:this.props.app.name})}),subjectContext:new de.sr.templates.SubjectContext({subjectClass:new de.sr.coding.CodedConcept({value:"121027",schemeDesignator:"DCM",meaning:"Specimen"}),subjectClassSpecificContext:new de.sr.templates.SubjectContextSpecimen({uid:s.SpecimenUID,identifier:s.SpecimenIdentifier,containerIdentifier:n.ContainerIdentifier})})});console.debug("encode Imaging Measurements");const r=[];for(let h=0;h<e.length;h++){var l;const t=e[h];if(!this.state.visibleRoiUIDs.has(t.uid))continue;let i=t.evaluations.find((e=>"121071"===e.ConceptNameCodeSequence[0].CodeValue));void 0===i&&Y.onError(q,new L(U,`No finding type was specified for ROI "${t.uid}"`));const n=new de.sr.templates.PlanarROIMeasurementsAndQualitativeEvaluations({trackingIdentifier:new de.sr.templates.TrackingIdentifier({uid:null!==(l=t.properties.trackingUID)&&void 0!==l?l:t.uid,identifier:`ROI #${h+1}`}),referencedRegion:new de.sr.contentItems.ImageRegion3D({graphicType:t.scoord3d.graphicType,graphicData:t.scoord3d.graphicData,frameOfReferenceUID:t.scoord3d.frameOfReferenceUID}),findingType:new de.sr.coding.CodedConcept({value:i.ConceptCodeSequence[0].CodeValue,schemeDesignator:i.ConceptCodeSequence[0].CodingSchemeDesignator,meaning:i.ConceptCodeSequence[0].CodeMeaning}),qualitativeEvaluations:t.evaluations.filter((e=>"121071"!==e.ConceptNameCodeSequence[0].CodeValue)),measurements:t.measurements});n[0].ContentTemplateSequence=[{MappingResource:"DCMR",TemplateIdentifier:"1410"}],r.push(...n)}console.debug("create Measurement Report document content");const c=new de.sr.templates.MeasurementReport({languageOfContentItemAndDescendants:new de.sr.templates.LanguageOfContentItemAndDescendants({}),observationContext:a,procedureReported:new de.sr.coding.CodedConcept({value:"112703",schemeDesignator:"DCM",meaning:"Whole Slide Imaging"}),imagingMeasurements:r});console.info("create Comprehensive 3D SR document");const d=new de.sr.documents.Comprehensive3DSR({content:c[0],evidence:[n],seriesInstanceUID:de.p.DicomMetaDictionary.uid(),seriesNumber:1,seriesDescription:"Annotation",sopInstanceUID:de.p.DicomMetaDictionary.uid(),instanceNumber:1,manufacturer:"MGH Computational Pathology",previousVersions:void 0});this.setState({isReportModalVisible:!0,generatedReport:d})}handleReportVerification(){console.info("verfied report");const e=this.state.generatedReport;if(void 0!==e){const t=e;console.debug("create File Meta Information");const i=new Uint8Array(2);i[1]=1;const n={"00020001":{Value:[i.buffer],vr:"OB"},"00020002":{Value:[t.SOPClassUID],vr:"UI"},"00020003":{Value:[t.SOPInstanceUID],vr:"UI"},"00020010":{Value:["1.2.840.10008.1.2.1"],vr:"UI"},"00020012":{Value:[this.props.app.uid],vr:"UI"}};console.info("store Comprehensive 3D SR document");const s=new de.p.DicomDict(n);s.dict=de.p.DicomMetaDictionary.denaturalizeDataset(t);const o=s.write();this.props.clients[V.COMPREHENSIVE_3D_SR].storeInstances({datasets:[o]}).then((e=>a.Ay.info("Annotations were saved."))).catch((e=>{console.error(e),Y.onError(q,new L(U,"Annotations could not be saved"))}))}this.setState({isReportModalVisible:!1,generatedReport:void 0})}handleReportCancellation(){this.setState({isReportModalVisible:!1,generatedReport:void 0})}handleAnnotationSelection(e){let{roiUID:t}=e;console.log(`selected ROI ${t}`),this.setState({selectedRoiUIDs:new Set([t])}),this.volumeViewer.getAllROIs().forEach((e=>{let i={};if(e.uid===t)i=this.selectedRoiStyle,this.setState((t=>{const i=t.visibleRoiUIDs;return i.add(e.uid),{visibleRoiUIDs:i}}));else if(this.state.visibleRoiUIDs.has(e.uid)){const t=yt(e);i=this.getRoiStyle(t)}this.volumeViewer.setROIStyle(e.uid,i)}))}handleAnnotationVisibilityChange(e){let{roiUID:t,isVisible:i}=e;if(i){console.info(`show ROI ${t}`);const e=this.volumeViewer.getROI(t),i=yt(e),n=this.getRoiStyle(i);this.volumeViewer.setROIStyle(e.uid,n),this.setState((t=>{const i=t.visibleRoiUIDs;return i.add(e.uid),{visibleRoiUIDs:i}}))}else console.info(`hide ROI ${t}`),this.setState((e=>{const i=e.selectedRoiUIDs;i.delete(t);const n=e.visibleRoiUIDs;return n.delete(t),{visibleRoiUIDs:n,selectedRoiUIDs:i}})),this.volumeViewer.setROIStyle(t,{})}handleAnnotationGroupVisibilityChange(e){let{annotationGroupUID:t,isVisible:i}=e;if(console.log(`change visibility of annotation group ${t}`),i){console.info(`show annotation group ${t}`);try{this.volumeViewer.showAnnotationGroup(t)}catch(n){throw Y.onError(q,new L(T,"Failed to show annotation group.")),n}this.setState((e=>{const i=new Set(e.visibleAnnotationGroupUIDs);return i.add(t),{visibleAnnotationGroupUIDs:i}}))}else console.info(`hide annotation group ${t}`),this.volumeViewer.hideAnnotationGroup(t),this.setState((e=>{const i=new Set(e.visibleAnnotationGroupUIDs);return i.delete(t),{visibleAnnotationGroupUIDs:i}}))}handleAnnotationGroupStyleChange(e){let{uid:t,styleOptions:i}=e;console.log(`change style of annotation group ${t}`);try{this.volumeViewer.setAnnotationGroupStyle(t,i)}catch(n){throw Y.onError(q,new L(T,"Failed to change style of annotation group.")),n}}generateRoiStyle(e){var t,i,n;const s=null!==(t=e.opacity)&&void 0!==t?t:.4,o=null!==(i=e.color)&&void 0!==i?i:gt,a=o.map((e=>Math.min(e+25,255)));return Ct({fill:{color:[...a,s]},stroke:{color:[...o,s]},radius:null===(n=this.defaultRoiStyle.stroke)||void 0===n?void 0:n.width})}handleRoiStyleChange(e){let{uid:t,styleOptions:i}=e;console.log(`change style of ROI ${t}`);try{this.defaultAnnotationStyles[t]=i;const e=this.generateRoiStyle(i),n=this.volumeViewer.getROI(t),s=yt(n);this.roiStyles[s]=e,this.volumeViewer.setROIStyle(t,e),this.state.visibleRoiUIDs.add(t)}catch(n){throw Y.onError(q,new L(T,"Failed to change style of ROI.")),n}}handleSegmentVisibilityChange(e){let{segmentUID:t,isVisible:i}=e;console.log(`change visibility of segment ${t}`),i?(console.info(`show segment ${t}`),this.volumeViewer.showSegment(t),this.setState((e=>{const i=new Set(e.visibleSegmentUIDs);return i.add(t),{visibleSegmentUIDs:i}}))):(console.info(`hide segment ${t}`),this.volumeViewer.hideSegment(t),this.setState((e=>{const i=new Set(e.visibleSegmentUIDs);return i.delete(t),{visibleSegmentUIDs:i}})))}handleSegmentStyleChange(e){let{segmentUID:t,styleOptions:i}=e;console.log(`change style of segment ${t}`),this.volumeViewer.setSegmentStyle(t,i)}handleMappingVisibilityChange(e){let{mappingUID:t,isVisible:i}=e;console.log(`change visibility of mapping ${t}`),i?(console.info(`show mapping ${t}`),this.volumeViewer.showParameterMapping(t),this.setState((e=>{const i=new Set(e.visibleMappingUIDs);return i.add(t),{visibleMappingUIDs:i}}))):(console.info(`hide mapping ${t}`),this.volumeViewer.hideParameterMapping(t),this.setState((e=>{const i=new Set(e.visibleMappingUIDs);return i.delete(t),{visibleMappingUIDs:i}})))}handleMappingStyleChange(e){let{mappingUID:t,styleOptions:i}=e;console.log(`change style of mapping ${t}`),this.volumeViewer.setParameterMappingStyle(t,i)}handleOpticalPathVisibilityChange(e){let{opticalPathIdentifier:t,isVisible:i}=e;console.log(`change visibility of optical path ${t}`),i?(console.info(`show optical path ${t}`),this.volumeViewer.showOpticalPath(t),this.setState((e=>{const i=new Set(e.visibleOpticalPathIdentifiers);return i.add(t),{visibleOpticalPathIdentifiers:i}}))):(console.info(`hide optical path ${t}`),this.volumeViewer.hideOpticalPath(t),this.setState((e=>{const i=new Set(e.visibleOpticalPathIdentifiers);return i.delete(t),{visibleOpticalPathIdentifiers:i}})))}handleOpticalPathStyleChange(e){let{opticalPathIdentifier:t,styleOptions:i}=e;console.log(`change style of optical path ${t}`),this.volumeViewer.setOpticalPathStyle(t,i)}handleOpticalPathActivityChange(e){let{opticalPathIdentifier:t,isActive:i}=e;console.log(`change activity of optical path ${t}`),i?(console.info(`activate optical path ${t}`),this.volumeViewer.activateOpticalPath(t),this.setState((e=>{const i=new Set(e.activeOpticalPathIdentifiers);return i.add(t),{activeOpticalPathIdentifiers:i}}))):(console.info(`deactivate optical path ${t}`),this.volumeViewer.deactivateOpticalPath(t),this.setState((e=>{const i=new Set(e.activeOpticalPathIdentifiers);return i.delete(t),{activeOpticalPathIdentifiers:i}})))}setDefaultPresentationState(){const e=new Set,t=this.volumeViewer.getAllOpticalPaths();if(t.sort(((e,t)=>1===e.identifier.localeCompare(t.identifier)?1:1===t.identifier.localeCompare(e.identifier)?-1:0)),t.forEach((t=>{const i=t.identifier,n=this.volumeViewer.getOpticalPathDefaultStyle(i);this.volumeViewer.setOpticalPathStyle(i,n),this.volumeViewer.hideOpticalPath(i),this.volumeViewer.deactivateOpticalPath(i),t.isMonochromatic?null!=t.paletteColorLookupTableUID&&e.add(i):e.add(i)})),0===e.size){const i=[[255,255,255]];t.forEach((t=>{const n=t.identifier;if(t.isMonochromatic){const s=e.size;if(s<i.length){const o={...this.volumeViewer.getOpticalPathStyle(n)},a=s;o.color=i[a];const r=this.state.pixelDataStatistics[t.identifier];null!=r&&(o.limitValues=[r.min,r.max]),this.volumeViewer.setOpticalPathStyle(t.identifier,o),e.add(t.identifier)}}}))}console.info(`selected n=${e.size} optical paths for visualization`),e.forEach((e=>{this.volumeViewer.showOpticalPath(e)})),this.setState((t=>({activeOpticalPathIdentifiers:new Set(e),visibleOpticalPathIdentifiers:new Set(e)})))}handlePresentationStateReset(){this.setState({selectedPresentationStateUID:void 0});const e=this.props.location.pathname;this.props.navigate(e),this.setDefaultPresentationState()}handlePresentationStateSelection(e,t){if(null!=e){let t;if(console.info(`select Presentation State instance "${e}"`),this.state.presentationStates.forEach((i=>{i.SOPInstanceUID===e&&(t=i)})),null!=t){let i=this.props.location.pathname;i+=`?state=${e}`,this.props.navigate(i),this.setPresentationState(t)}else Y.onError(q,new L(T,"Presentation State could not be found")),console.log(`failed to handle section of presentation state: could not find instance "${e}"`)}else this.handlePresentationStateReset();this.setState({selectedPresentationStateUID:e})}handleRoiDrawing(){this.state.isRoiDrawingActive?(console.info("deactivate drawing of ROIs"),this.volumeViewer.deactivateDrawInteraction(),this.volumeViewer.activateSelectInteraction({}),this.setState({isAnnotationModalVisible:!1,isSelectedRoiModalVisible:!1,isRoiTranslationActive:!1,isRoiDrawingActive:!1,isRoiModificationActive:!1,isGoToModalVisible:!1})):(console.info("activate drawing of ROIs"),this.setState({isAnnotationModalVisible:!0,isSelectedRoiModalVisible:!1,isRoiDrawingActive:!0,isRoiModificationActive:!1,isRoiTranslationActive:!1,isGoToModalVisible:!1}),this.volumeViewer.deactivateSelectInteraction(),this.volumeViewer.deactivateSnapInteraction(),this.volumeViewer.deactivateTranslateInteraction(),this.volumeViewer.deactivateModifyInteraction())}handleRoiModification(){console.info("toggle modification of ROIs"),this.volumeViewer.isModifyInteractionActive?(this.volumeViewer.deactivateModifyInteraction(),this.volumeViewer.deactivateSnapInteraction(),this.volumeViewer.activateSelectInteraction({}),this.setState({isRoiTranslationActive:!1,isRoiDrawingActive:!1,isRoiModificationActive:!1})):(this.setState({isRoiModificationActive:!0,isRoiDrawingActive:!1,isRoiTranslationActive:!1}),this.volumeViewer.deactivateDrawInteraction(),this.volumeViewer.deactivateTranslateInteraction(),this.volumeViewer.deactivateSelectInteraction(),this.volumeViewer.activateSnapInteraction({}),this.volumeViewer.activateModifyInteraction({}))}handleRoiTranslation(){console.info("toggle translation of ROIs"),this.volumeViewer.isTranslateInteractionActive?(this.volumeViewer.deactivateTranslateInteraction(),this.setState({isRoiTranslationActive:!1,isRoiDrawingActive:!1,isRoiModificationActive:!1})):(this.setState({isRoiTranslationActive:!0,isRoiDrawingActive:!1,isRoiModificationActive:!1}),this.volumeViewer.deactivateModifyInteraction(),this.volumeViewer.deactivateSnapInteraction(),this.volumeViewer.deactivateDrawInteraction(),this.volumeViewer.deactivateSelectInteraction(),this.volumeViewer.activateTranslateInteraction({}))}handleGoTo(){this.volumeViewer.deactivateDrawInteraction(),this.volumeViewer.deactivateModifyInteraction(),this.volumeViewer.deactivateSnapInteraction(),this.volumeViewer.deactivateTranslateInteraction(),this.volumeViewer.deactivateSelectInteraction(),this.setState({isGoToModalVisible:!0,isAnnotationModalVisible:!1,isSelectedRoiModalVisible:!1,isReportModalVisible:!1,isRoiTranslationActive:!1,isRoiModificationActive:!1,isRoiDrawingActive:!1})}handleRoiRemoval(){this.volumeViewer.deactivateDrawInteraction(),this.volumeViewer.deactivateSnapInteraction(),this.volumeViewer.deactivateTranslateInteraction(),this.volumeViewer.deactivateModifyInteraction(),this.state.selectedRoiUIDs.size>0?(this.state.selectedRoiUIDs.forEach((e=>{void 0!==e?(console.info(`remove ROI "${e}"`),this.volumeViewer.removeROI(e),a.Ay.info("Annotation was removed")):a.Ay.warning("No annotation was selected for removal")})),this.setState({selectedRoiUIDs:new Set,isRoiTranslationActive:!1,isRoiDrawingActive:!1,isRoiModificationActive:!1})):(this.state.visibleRoiUIDs.forEach((e=>{console.info(`remove ROI "${e}"`),this.volumeViewer.removeROI(e)})),this.setState({visibleRoiUIDs:new Set,isRoiTranslationActive:!1,isRoiDrawingActive:!1,isRoiModificationActive:!1})),this.volumeViewer.activateSelectInteraction({})}handleRoiVisibilityChange(){console.info("toggle visibility of ROIs"),this.volumeViewer.areROIsVisible?(this.volumeViewer.deactivateDrawInteraction(),this.volumeViewer.deactivateSnapInteraction(),this.volumeViewer.deactivateTranslateInteraction(),this.volumeViewer.deactivateSelectInteraction(),this.volumeViewer.deactivateModifyInteraction(),this.volumeViewer.hideROIs(),this.setState({areRoisHidden:!0,isRoiDrawingActive:!1,isRoiModificationActive:!1,isRoiTranslationActive:!1})):(this.volumeViewer.showROIs(),this.volumeViewer.activateSelectInteraction({}),this.state.selectedRoiUIDs.forEach((e=>{void 0!==e&&this.volumeViewer.setROIStyle(e,this.selectedRoiStyle)})),this.setState({areRoisHidden:!1}))}render(){const e=[],t=[],i=[],s=[];e.push(...this.volumeViewer.getAllROIs()),t.push(...this.volumeViewer.getAllSegments()),i.push(...this.volumeViewer.getAllParameterMappings());const o=this.volumeViewer.getAllAnnotationGroups(),a=null===o||void 0===o?void 0:o.filter((e=>e.referencedSeriesInstanceUID===this.props.seriesInstanceUID));s.push(...a);const d=e.map((e=>(e=>{const{uid:t,evaluations:i}=e,n={category:{CodeValue:"undefined",CodeMeaning:"undefined",CodingSchemeDesignator:"undefined"},type:{CodeValue:"undefined",CodeMeaning:"undefined",CodingSchemeDesignator:"undefined"}};return i.forEach((e=>{const t=e.ConceptNameCodeSequence[0].CodeValue;if(e.ValueType===de.sr.valueTypes.ValueTypes.CODE){const i=e.ConceptCodeSequence[0];"276214006"===t?n.category={...i}:"121071"===t&&(n.type={...i})}})),{...n,uid:t}})(e))),u=["specimens","optical-paths","annotations","presentation-states"];let m;const g=this.state.generatedReport;let S;void 0!==g&&(m=(0,p.jsx)(Ue,{dataset:g})),e.length>0&&(S=(0,p.jsx)(ge,{rois:e,selectedRoiUIDs:this.state.selectedRoiUIDs,visibleRoiUIDs:this.state.visibleRoiUIDs,onSelection:this.handleAnnotationSelection,onVisibilityChange:this.handleAnnotationVisibilityChange}));const v=this.findingOptions.map((e=>(0,p.jsx)(J.A.Option,{value:e.CodeValue,children:e.CodeMeaning},e.CodeValue))),y={point:(0,p.jsx)(J.A.Option,{value:"point",children:"Point"},"point"),circle:(0,p.jsx)(J.A.Option,{value:"circle",children:"Circle"},"circle"),box:(0,p.jsx)(J.A.Option,{value:"box",children:"Box"},"box"),polygon:(0,p.jsx)(J.A.Option,{value:"polygon",children:"Polygon"},"polygon"),line:(0,p.jsx)(J.A.Option,{value:"line",children:"Line"},"line"),freehandpolygon:(0,p.jsx)(J.A.Option,{value:"freehandpolygon",children:"Polygon (freehand)"},"freehandpolygon"),freehandline:(0,p.jsx)(J.A.Option,{value:"freehandline",children:"Line (freehand)"},"freehandline")},C=[(0,p.jsx)(J.A,{style:{minWidth:130},onSelect:this.handleAnnotationFindingSelection,defaultActiveFirstOption:!0,children:v},"annotation-finding")],f=this.state.selectedFinding;if(void 0!==f){const e=vt(f);this.evaluationOptions[e].forEach((e=>{const t=e.values.map((t=>(0,p.jsx)(J.A.Option,{value:t.CodeValue,label:e.name,children:t.CodeMeaning},t.CodeValue)));C.push((0,p.jsxs)(p.Fragment,{children:[e.name.CodeMeaning,(0,p.jsx)(J.A,{style:{minWidth:130},onSelect:this.handleAnnotationEvaluationSelection,allowClear:!0,onClear:this.handleAnnotationEvaluationClearance,defaultActiveFirstOption:!1,children:t})]}))}));const t=this.geometryTypeOptions[e].map((e=>y[e]));C.push((0,p.jsxs)(p.Fragment,{children:["ROI geometry type",(0,p.jsx)(J.A,{style:{minWidth:130},onSelect:this.handleAnnotationGeometryTypeSelection,children:t},"annotation-geometry-type")]})),C.push((0,p.jsx)(Z.A,{onChange:this.handleAnnotationMeasurementActivation,children:"measure"},"annotation-measurement"))}const I=(0,p.jsx)(c.A.SubMenu,{title:"Specimens",children:(0,p.jsx)(Fe,{metadata:this.props.slide.volumeImages[0],showstain:!1})},"specimens"),b=(0,p.jsx)(c.A.SubMenu,{title:"Equipment",children:(0,p.jsx)(Re,{metadata:this.props.slide.volumeImages[0]})},"equipment"),w=this.volumeViewer.getAllOpticalPaths();w.sort(((e,t)=>1===e.identifier.localeCompare(t.identifier)?1:1===t.identifier.localeCompare(e.identifier)?-1:0));const x={},A={};w.forEach((e=>{const t=e.identifier,i=this.volumeViewer.getOpticalPathMetadata(t);A[t]=i;const n={...this.volumeViewer.getOpticalPathStyle(t)};x[t]=n}));const D=(0,p.jsx)(c.A.SubMenu,{title:"Optical Paths",children:(0,p.jsx)(Je,{metadata:A,opticalPaths:w,defaultOpticalPathStyles:x,visibleOpticalPathIdentifiers:this.state.visibleOpticalPathIdentifiers,activeOpticalPathIdentifiers:this.state.activeOpticalPathIdentifiers,onOpticalPathVisibilityChange:this.handleOpticalPathVisibilityChange,onOpticalPathStyleChange:this.handleOpticalPathStyleChange,onOpticalPathActivityChange:this.handleOpticalPathActivityChange,selectedPresentationStateUID:this.state.selectedPresentationStateUID})},"optical-paths");let V,R,j,O,M;if(this.state.presentationStates.length>0){const e=[];this.state.presentationStates.forEach((t=>{e.push((0,p.jsx)(J.A.Option,{value:t.SOPInstanceUID,dropdownMatchSelectWidth:!1,size:"small",children:t.ContentDescription},t.SOPInstanceUID))})),e.push((0,p.jsx)(J.A.Option,{value:void 0,dropdownMatchSelectWidth:!1,size:"small",children:(0,p.jsx)(p.Fragment,{})},"default-presentation-state")),V=(0,p.jsx)(c.A.SubMenu,{title:"Presentation States",children:(0,p.jsxs)(ee.A,{align:"center",size:20,style:{padding:"14px"},children:[(0,p.jsx)(J.A,{style:{minWidth:200,maxWidth:200},onSelect:this.handlePresentationStateSelection,value:this.state.selectedPresentationStateUID,children:e},"presentation-states"),(0,p.jsx)(te.A,{title:"Reset",children:(0,p.jsx)(ie.A,{icon:(0,p.jsx)(re.A,{}),type:"primary",onClick:this.handlePresentationStateReset})})]})},"presentation-states")}if(t.length>0){const e={},t={},i=this.volumeViewer.getAllSegments();i.forEach((i=>{e[i.uid]=this.volumeViewer.getSegmentStyle(i.uid),t[i.uid]=this.volumeViewer.getSegmentMetadata(i.uid)})),R=(0,p.jsx)(c.A.SubMenu,{title:"Segmentations",children:(0,p.jsx)(at,{segments:i,metadata:t,defaultSegmentStyles:e,visibleSegmentUIDs:this.state.visibleSegmentUIDs,onSegmentVisibilityChange:this.handleSegmentVisibilityChange,onSegmentStyleChange:this.handleSegmentStyleChange})},"segmentations"),u.push("segmentations")}if(i.length>0){const e={},t={};i.forEach((i=>{e[i.uid]=this.volumeViewer.getParameterMappingStyle(i.uid),t[i.uid]=this.volumeViewer.getParameterMappingMetadata(i.uid)})),j=(0,p.jsx)(c.A.SubMenu,{title:"Parametric Maps",children:(0,p.jsx)(it,{mappings:i,metadata:t,defaultMappingStyles:e,visibleMappingUIDs:this.state.visibleMappingUIDs,onMappingVisibilityChange:this.handleMappingVisibilityChange,onMappingStyleChange:this.handleMappingStyleChange})},"parmetric-maps"),u.push("parametric-maps")}if(d.length>0&&d.forEach((e=>{var t;const i=this.volumeViewer.getROI(e.uid),n=yt(i),s=void 0!==this.roiStyles[n]?null===(t=this.roiStyles[n].stroke)||void 0===t?void 0:t.color.slice(0,3):St[Object.keys(this.roiStyles).length%St.length];this.defaultAnnotationStyles[e.uid]={color:s,opacity:.4},this.roiStyles[n]=this.generateRoiStyle(this.defaultAnnotationStyles[e.uid])})),s.length>0){const e={},t={};s.forEach((i=>{t[i.uid]=this.volumeViewer.getAnnotationGroupStyle(i.uid),e[i.uid]=this.volumeViewer.getAnnotationGroupMetadata(i.uid)})),O=(0,p.jsx)(c.A.SubMenu,{title:"Annotation Groups",children:(0,p.jsx)(xe,{annotationGroups:s,metadata:e,defaultAnnotationGroupStyles:t,visibleAnnotationGroupUIDs:this.state.visibleAnnotationGroupUIDs,onAnnotationGroupVisibilityChange:this.handleAnnotationGroupVisibilityChange,onAnnotationGroupStyleChange:this.handleAnnotationGroupStyleChange})},"annotation-groups"),u.push("annotationGroups")}let P="0px";const E=[(0,p.jsx)(De,{tooltip:"Draw ROI [Alt+D]",icon:l.YZt,onClick:this.handleRoiDrawing,isSelected:this.state.isRoiDrawingActive},"draw-roi-button"),(0,p.jsx)(De,{tooltip:"Modify ROIs [Alt+M]",icon:l.oE,onClick:this.handleRoiModification,isSelected:this.state.isRoiModificationActive},"modify-roi-button"),(0,p.jsx)(De,{tooltip:"Translate ROIs [Alt+T]",icon:l.XzC,onClick:this.handleRoiTranslation,isSelected:this.state.isRoiTranslationActive},"translate-roi-button"),(0,p.jsx)(De,{tooltip:"Remove selected ROI [Alt+R]",onClick:this.handleRoiRemoval,icon:l.qbC},"remove-roi-button"),(0,p.jsx)(De,{tooltip:"Show/Hide ROIs [Alt+V]",icon:this.state.areRoisHidden?l.Ny1:l.mx3,onClick:this.handleRoiVisibilityChange,isSelected:this.state.areRoisHidden},"toggle-roi-visibility-button"),(0,p.jsx)(De,{tooltip:"Save ROIs [Alt+S]",icon:l.dIn,onClick:this.handleReportGeneration},"generate-report-button")],U=[(0,p.jsx)(De,{tooltip:"Go to [Alt+G]",icon:l.hO$,onClick:this.handleGoTo},"go-to-slide-position-button")];this.props.enableAnnotationTools&&(M=(0,p.jsxs)(ne.A,{justify:"start",children:[E.map(((e,t)=>(0,p.jsx)(n.Fragment,{children:e},t))),U.map(((e,t)=>(0,p.jsx)(n.Fragment,{children:e},t)))]}),P="50px");let T,L="default";if(this.state.isLoading&&(L="progress"),null!=this.state.selectedRoi){const e=[{name:"UID",value:this.state.selectedRoi.uid}],t=[{name:"Graphic type",value:this.state.selectedRoi.scoord3d.graphicType}],i=[];this.state.selectedRoi.evaluations.forEach((e=>{if("CODE"===e.ValueType){const t=e;i.push({name:t.ConceptNameCodeSequence[0].CodeMeaning,value:t.ConceptCodeSequence[0].CodeMeaning})}else{const t=e;i.push({name:t.ConceptNameCodeSequence[0].CodeMeaning,value:t.TextValue})}}));const n={};this.state.selectedRoi.measurements.forEach((e=>{let t="default";if(null!=e.ContentSequence){const i=je({content:e.ContentSequence,name:new de.sr.coding.CodedConcept({value:"121112",meaning:"Source of Measurement",schemeDesignator:"DCM"})});i.length>0&&(t=i[0].ReferencedSOPSequence[0].ReferencedOpticalPathIdentifier)}t in n||(n[t]=[]);const i=e.MeasuredValueSequence[0];n[t].push({name:e.ConceptNameCodeSequence[0].CodeMeaning,value:i.NumericValue.toString(),unit:i.MeasurementUnitsCodeSequence[0].CodeMeaning})}));const s=e=>e.map((e=>{let t;return t=null!=e.unit?`${e.value} [${e.unit}]`:e.value,(0,p.jsx)(h.A.Item,{label:e.name,children:t},e.name)})),o=s(e),a=s(t),r=s(i),l=[];for(const c in n){const e=s(n[c]);"default"===c?l.push(e):l.push((0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(se.A,{orientation:"left",orientationMargin:0,dashed:!0,plain:!0,children:c}),e]}))}T=(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.A,{layout:"horizontal",column:1,children:o}),(0,p.jsx)(se.A,{orientation:"left",orientationMargin:0,children:"Spatial coordinates"}),(0,p.jsx)(h.A,{layout:"horizontal",column:1,children:a}),(0,p.jsx)(se.A,{orientation:"left",orientationMargin:0,children:"Evaluations"}),(0,p.jsx)(h.A,{layout:"horizontal",column:1,children:r}),(0,p.jsx)(se.A,{orientation:"left",orientationMargin:0,children:"Measurements"}),(0,p.jsx)(h.A,{layout:"horizontal",column:1,children:l})]})}return(0,p.jsxs)(r.A,{style:{height:"100%"},hasSider:!0,children:[(0,p.jsxs)(r.A.Content,{style:{height:"100%"},children:[M,(0,p.jsx)("div",{style:{height:`calc(100% - ${P})`,overflow:"hidden",cursor:L},ref:this.volumeViewportRef}),(0,p.jsx)(oe.A,{open:this.state.isAnnotationModalVisible,title:"Configure annotations",onOk:this.handleAnnotationConfigurationCompletion,onCancel:this.handleAnnotationConfigurationCancellation,okText:"Select",children:(0,p.jsx)(ee.A,{align:"start",direction:"vertical",children:C})}),(0,p.jsx)(oe.A,{open:this.state.isSelectedRoiModalVisible,title:"Selected ROI",onCancel:this.handleRoiSelectionCancellation,maskClosable:!0,footer:null,children:(0,p.jsx)(ee.A,{align:"start",direction:"vertical",children:T})}),(0,p.jsx)(oe.A,{open:this.state.isGoToModalVisible,title:"Go to slide position",onOk:this.handleSlidePositionSelection,onCancel:this.handleSlidePositionSelectionCancellation,okText:"Select",children:(0,p.jsxs)(ee.A,{align:"start",direction:"vertical",children:[(0,p.jsx)(ae.A,{placeholder:`[${this.state.validXCoordinateRange[0]}, ${this.state.validXCoordinateRange[1]}]`,prefix:"X Coordinate [mm]",onChange:this.handleXCoordinateSelection,onPressEnter:this.handleXCoordinateSelection,controls:!1,addonAfter:this.state.isSelectedXCoordinateValid?(0,p.jsx)(le.A,{style:{color:"rgba(0,0,0,.45)"}}):(0,p.jsx)(ce.A,{style:{color:"rgba(0,0,0,.45)"}})}),(0,p.jsx)(ae.A,{placeholder:`[${this.state.validYCoordinateRange[0]}, ${this.state.validYCoordinateRange[1]}]`,prefix:"Y Coordinate [mm]",onChange:this.handleYCoordinateSelection,onPressEnter:this.handleYCoordinateSelection,controls:!1,addonAfter:this.state.isSelectedYCoordinateValid?(0,p.jsx)(le.A,{style:{color:"rgba(0,0,0,.45)"}}):(0,p.jsx)(ce.A,{style:{color:"rgba(0,0,0,.45)"}})}),(0,p.jsx)(ae.A,{placeholder:"[0 - 40]",prefix:"Magnification",onChange:this.handleMagnificationSelection,onPressEnter:this.handleMagnificationSelection,controls:!1,addonAfter:this.state.isSelectedMagnificationValid?(0,p.jsx)(le.A,{style:{color:"rgba(0,0,0,.45)"}}):(0,p.jsx)(ce.A,{style:{color:"rgba(0,0,0,.45)"}})})]})}),(0,p.jsx)(oe.A,{open:this.state.isReportModalVisible,title:"Verify and save report",onOk:this.handleReportVerification,onCancel:this.handleReportCancellation,okText:"Save",children:m})]}),(0,p.jsx)(r.A.Sider,{width:300,reverseArrow:!0,style:{borderLeft:"solid",borderLeftWidth:.25,overflow:"hidden",background:"none"},children:(0,p.jsxs)(c.A,{mode:"inline",defaultOpenKeys:u,style:{height:"100%"},inlineIndent:14,forceSubMenuRender:!0,onOpenChange:()=>{setTimeout((()=>{null!=this.labelViewer&&this.labelViewer.resize()}),100)},children:[null!=this.labelViewportRef.current&&(0,p.jsx)(c.A.SubMenu,{title:"Slide label",children:(0,p.jsx)(c.A.Item,{style:{height:"100%"},children:(0,p.jsx)("div",{style:{height:"220px"},ref:this.labelViewportRef})},"image")},"label"),I,b,D,V,(0,p.jsx)(c.A.SubMenu,{title:"Annotations",children:S},"annotations"),O,0===d.length?(0,p.jsx)(p.Fragment,{}):(0,p.jsx)(c.A.SubMenu,{title:"Annotation Categories",children:(0,p.jsx)(ht,{annotations:d,onChange:this.handleAnnotationVisibilityChange,checkedAnnotationUids:this.state.visibleRoiUIDs,onStyleChange:this.handleRoiStyleChange,defaultAnnotationStyles:this.defaultAnnotationStyles})},"annotation-category"),R,j]})}),this.state.isHoveredRoiTooltipVisible&&this.state.hoveredRoiAttributes.length>0?(0,p.jsx)(ut,{xPosition:this.state.hoveredRoiTooltipX,yPosition:this.state.hoveredRoiTooltipY,attributes:this.state.hoveredRoiAttributes}):(0,p.jsx)(p.Fragment,{})]})}}const bt=rt(It);var wt=function(e){return e.VOLUME="VOLUME",e.LABEL="LABEL",e.OVERVIEW="OVERVIEW",e.THUMBNAIL="THUMBNAIL",e}(wt||{});const xt=(e,t)=>e.ImageType[2]===t,At=(e,t)=>null!=e.AcquisitionUID&&e.AcquisitionUID===t.AcquisitionUID;class Dt{constructor(e){this.description=void 0,this.acquisitionUID=void 0,this.frameOfReferenceUID=void 0,this.containerIdentifier=void 0,this.seriesInstanceUIDs=void 0,this.opticalPathIdentifiers=void 0,this.pyramidUIDs=[],this.areVolumeImagesMonochrome=void 0,this.volumeImages=void 0,this.labelImages=void 0,this.overviewImages=void 0,0===e.images.length&&Y.onError(q,new L(U,'Value of option "images" have been non-zero length.'));const t=new Set([]),i=new Set([]),n=new Set([]),s=new Set([]),o={VOLUME:new Set([]),LABEL:new Set([]),OVERVIEW:new Set([])},a={VOLUME:{}},r=[],l=[],c=[];if(e.images.forEach((e=>{if(s.add(e.ContainerIdentifier),t.add(e.SeriesInstanceUID),e.OpticalPathSequence.forEach((e=>{n.add(e.OpticalPathIdentifier)})),null!=e.AcquisitionUID&&i.add(e.AcquisitionUID),xt(e,wt.VOLUME)||xt(e,wt.THUMBNAIL)){if(o.VOLUME.add(e.FrameOfReferenceUID),null!=e.PyramidUID)for(const t in n)a.VOLUME[t].add(e.PyramidUID);r.push(e)}else xt(e,wt.LABEL)?(o.LABEL.add(e.FrameOfReferenceUID),l.push(e)):xt(e,wt.OVERVIEW)&&(o.OVERVIEW.add(e.FrameOfReferenceUID),c.push(e))})),0===r.length)Y.onError(q,new L(U,"At least one VOLUME image must be provided for a slide."));else{i.size>1&&Y.onError(q,new L(U,"All VOLUME images of a slide must have the same number of Samples per Pixel."));const e=new Set([]);r.forEach((t=>{e.add(t.SamplesPerPixel)})),e.size>1&&Y.onError(q,new L(U,"All VOLUME images of a slide must have the same number of Samples per Pixel."));r.filter((e=>"RESAMPLED"!==e.ImageType[3])).length>n.size&&console.warn("the set of VOLUME images of a slide must contain only a single image that has not been resampled per optical path")}this.volumeImages=r,this.labelImages=l,this.overviewImages=c,this.seriesInstanceUIDs=[...t],this.opticalPathIdentifiers=[...n],1!==s.size&&Y.onError(q,new L(U,"All images of a slide must have the same Container Identifier.")),this.containerIdentifier=[...s][0],1!==o.VOLUME.size&&Y.onError(q,new L(U,"All VOLUME images of a slide must have the same Frame of Reference UID.")),this.frameOfReferenceUID=[...o.VOLUME][0];let d=!1;Object.keys(a.VOLUME).length>0&&(d=!0),this.opticalPathIdentifiers.forEach((e=>{null!=a.VOLUME[e]?a.VOLUME[e].size>1?Y.onError(q,new L(U,`All VOLUME images for optical path "${e}"must be part of the same multi-resolution pyramid.`)):1===a.VOLUME[e].size?this.pyramidUIDs.push([...a.VOLUME[e]][0]):Y.onError(q,new L(U,`The VOLUME images for optical path "${e}" lack the Pyramid UID, while the images for other optical paths contain it.`)):d&&Y.onError(q,new L(U,`The VOLUME images for optical path "${e}" lack the Pyramid UID, while the images for other optical paths contain it.`))})),i.size>1?Y.onError(q,new L(U,"All VOLUME images of a slide must be part of the same  acquisition and have the same Acquisition UID.")):1===i.size?this.acquisitionUID=[...i][0]:this.acquisitionUID=null,this.areVolumeImagesMonochrome=1===this.volumeImages[0].SamplesPerPixel&&"MONOCHROME2"===this.volumeImages[0].PhotometricInterpretation,this.description=void 0!==e.description?e.description:""}}const Vt=async e=>{let{clients:t,studyInstanceUID:i,onSuccess:n,onError:s}=e;try{const e=[];console.info(`search for series of study "${i}"...`);const s=t[V.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE],o=await s.searchForSeries({queryParams:{Modality:"SM",StudyInstanceUID:i}});await Promise.all(o.map((async t=>{const{dataset:n}=D.metadata.formatMetadata(t),o=n;console.info(`retrieve metadata of series "${o.SeriesInstanceUID}"`);const a=await s.retrieveSeriesMetadata({studyInstanceUID:i,seriesInstanceUID:o.SeriesInstanceUID}),r=[];a.forEach((e=>{var t,i;if((null===(t=e["00080016"])||void 0===t||null===(i=t.Value)||void 0===i?void 0:i[0])===V.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE){const t=new D.metadata.VLWholeSlideMicroscopyImage({metadata:e});r.push(t)}})),r.length>0&&e.push(r)})));const a=(e=>{const t=[];e.forEach((e=>{if(e.length>0){const i=e.filter((e=>xt(e,wt.VOLUME)||xt(e,wt.THUMBNAIL)));if(i.length>0){const n=i[0],s=i.filter((e=>n.SamplesPerPixel===e.SamplesPerPixel)),o=t.findIndex((e=>function(e,t){return e.frameOfReferenceUID===t.FrameOfReferenceUID&&e.containerIdentifier===t.ContainerIdentifier&&e.acquisitionUID===t.AcquisitionUID}(e,n))),a=e.filter((e=>xt(e,wt.LABEL)));let r;r=a.length>1?a.filter((e=>At(e,n))):a;const l=e.filter((e=>xt(e,wt.OVERVIEW)));let c;if(c=l.length>1?l.filter((e=>At(e,n))):l,-1===o){const e={acquisitionUID:n.AcquisitionUID,frameOfReferenceUID:n.FrameOfReferenceUID,containerIdentifier:n.ContainerIdentifier,volumeImages:s,labelImages:r,overviewImages:c};t.push(e)}else{const e=t[o];e.volumeImages.push(...s),e.labelImages.push(...r),e.overviewImages.push(...c)}}}}));let i=t.map((e=>new Dt({images:[...e.volumeImages,...e.labelImages,...e.overviewImages]})));return i=i.sort(((e,t)=>{const i=e.volumeImages[0],n=t.volumeImages[0];return null!=i.ContainerIdentifier&&null!=n.ContainerIdentifier?Number(i.ContainerIdentifier)-Number(n.ContainerIdentifier):0})),i})(e);n(a)}catch(o){console.error(o);const e=new L(U,"Image metadata could not be retrieved or decoded.");s(e),Y.onError(q,e)}},Rt=new Map,jt=new Map,Ot=e=>{let{clients:t,studyInstanceUID:i}=e;const[s,o]=(0,n.useState)([]),[a,r]=(0,n.useState)(!1),[l,c]=(0,n.useState)(null);return(0,n.useEffect)((()=>{if(void 0===i)return o([]),void r(!1);const e=Rt.get(i);if(void 0!==e)return o(e),void r(!1);r(!0);(async()=>{let e=jt.get(i);void 0===e&&(e=new Promise(((e,n)=>{Vt({clients:t,studyInstanceUID:i,onSuccess:t=>{Rt.set(i,t),e(t)},onError:e=>{n(e)}}).catch((e=>{n(e)}))})),jt.set(i,e));try{const t=await e;o(t),c(null)}catch(n){c(n),o([])}finally{jt.delete(i),r(!1)}})()}),[t,i]),{slides:s,isLoading:a,error:l}};function Mt(e){let{clients:t,slides:i,user:n,app:o,preload:a,enableAnnotationTools:r,annotations:l}=e;const{studyInstanceUID:c,seriesInstanceUID:d}=(0,s.g)(),h=(0,s.zy)(),u=i.find((e=>e.seriesInstanceUIDs.find((e=>e===d)))),m=new URLSearchParams(h.search);let g;m.has("access_token")||(g=m.get("state"),null===g&&(g=void 0));let S=null;return null!=u&&(S=(0,p.jsx)(bt,{clients:t,studyInstanceUID:c,seriesInstanceUID:d,selectedPresentationStateUID:g,slide:u,preload:a,annotations:l,enableAnnotationTools:r,app:o,user:n})),S}const Pt=rt((function(e){const{clients:t,studyInstanceUID:i,location:n,navigate:o}=e,{slides:a,isLoading:l}=Ot({clients:t,studyInstanceUID:i});if(l)return null;if(0===a.length)return null;const d=a[0].volumeImages;if(0===d.length)return null;const h=d[0];let u,m;if(n.pathname.includes("series/")){const e=n.pathname.split("series/")[1];u=e.includes("/")?e.split("/")[0]:e}else u=d[0].SeriesInstanceUID;return null!=h.ClinicalTrialSponsorName&&(m=(0,p.jsx)(c.A.SubMenu,{title:"Clinical Trial",children:(0,p.jsx)(v,{metadata:h})},"clinical-trial")),(0,p.jsxs)(r.A,{style:{height:"100%"},hasSider:!0,children:[(0,p.jsx)(r.A.Sider,{width:300,style:{height:"100%",borderRight:"solid",borderRightWidth:.25,overflow:"hidden",background:"none"},children:(0,p.jsxs)(c.A,{mode:"inline",defaultOpenKeys:["patient","study","clinical-trial","slides"],style:{height:"100%"},inlineIndent:14,children:[(0,p.jsx)(c.A.SubMenu,{title:"Patient",children:(0,p.jsx)(w,{metadata:h})},"patient"),(0,p.jsx)(c.A.SubMenu,{title:"Study",children:(0,p.jsx)(A,{metadata:h})},"study"),m,(0,p.jsx)(c.A.SubMenu,{title:"Slides",children:(0,p.jsx)(Q,{clients:e.clients,metadata:a,selectedSeriesInstanceUID:u,onSeriesSelection:e=>{let{seriesInstanceUID:t}=e;console.info(`switch to series "${t}"`);let s=`/studies/${i}/series/${t}`;n.pathname.includes("/projects/")&&(s=n.pathname,n.pathname.includes("/series/")?s=s.replace(/\/series\/[^/]+/,`/series/${t}`):s+=`/series/${t}`),n.pathname.includes("/series/")&&null!=n.search&&(s+=n.search),o(s,{replace:!0})}})},"slides")]})}),(0,p.jsx)(s.BV,{children:(0,p.jsx)(s.qh,{path:"/series/:seriesInstanceUID",element:(0,p.jsx)(Mt,{clients:e.clients,slides:a,preload:e.preload,annotations:e.annotations,enableAnnotationTools:e.enableAnnotationTools,app:e.app,user:e.user})})})]})}));var Et=i(1068),Ut=i(8826),Tt=i(5389),Lt=i(3722),kt=i(4459),_t=i(4849),Nt=i(5120),$t=i(1558),Gt=i(9827),qt=i(435),Ft=i(3554),zt=i(2058);const{DicomMetaDictionary:Bt}=de.Ay.data,{nameMap:Wt}=Bt,Yt=e=>"object"===typeof e&&null!==e?JSON.stringify(e):String(e);function Ht(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object.keys(e).filter((e=>"_vrMap"!==e)).flatMap((i=>{var n,s;const o=Wt[i];let a=e[i];if(void 0===o){var r,l;const e=/[0-9A-Fa-f]{6}/g;return null==i.match(e)?[]:[{tag:`(${i.substring(0,4)},${i.substring(4,8)})`,vr:"",keyword:"Private Tag",value:null!==(r=null===(l=a)||void 0===l?void 0:l.toString())&&void 0!==r?r:"",level:t}]}if("SQ"===o.vr&&void 0!==a){const e=Array.isArray(a)?a:[a],n={tag:o.tag,vr:o.vr,keyword:i,value:`Sequence with ${e.length} item(s)`,level:t,children:[]};return n.children=e.map(((e,i)=>({tag:`${o.tag}.${i+1}`,vr:"Item",keyword:`Item ${i+1}`,value:`Sequence Item ${i+1}`,level:t+1,children:Ht(e,t+2)}))),[n]}return Array.isArray(a)?a=a.map(Yt).join("\\"):"object"===typeof a&&null!==a&&(a=Yt(a)),[{tag:o.tag,vr:o.vr,keyword:i.replace("RETIRED_",""),value:null!==(n=null===(s=a)||void 0===s?void 0:s.toString())&&void 0!==n?n:"",level:t}]}))}function Xt(e){return Ht(e).sort(((e,t)=>e.tag.localeCompare(t.tag)))}const{Option:Kt}=J.A,Qt=e=>{var t,i;let{clients:s,studyInstanceUID:o}=e;const{slides:a,isLoading:r}=Ot({clients:s,studyInstanceUID:o}),[l,c]=(0,n.useState)([]),[d,h]=(0,n.useState)(0),[u,m]=(0,n.useState)(1),[g,S]=(0,n.useState)(""),[v,y]=(0,n.useState)([]),[C,f]=(0,n.useState)([]);(0,n.useEffect)((()=>{if(0===a.length)return;const e=a.map(((e,t)=>{const{volumeImages:i}=e;if(void 0===(null===i||void 0===i?void 0:i[0]))return null;const{SeriesDate:n,SeriesTime:s,SeriesNumber:o,SeriesDescription:a,Modality:r}=i[0];return{displaySetInstanceUID:t,SeriesDate:n,SeriesTime:s,SeriesNumber:o,SeriesDescription:a,Modality:r,images:i}})).filter((e=>null!==e));c(e)}),[a]);const I=(0,n.useMemo)((()=>(l.sort(((e,t)=>e.SeriesNumber-t.SeriesNumber)),l.map((e=>{const{displaySetInstanceUID:t,SeriesDate:i,SeriesTime:n,SeriesNumber:s,SeriesDescription:o,Modality:a}=e,r=(e=>{const t=e.match(/^(\d{4})(\d{2})(\d{2}):(\d{2})(\d{2})(\d{2})/);if(null==t)return e;const[,i,n,s,o,a,r]=t,l=parseInt(n),c=parseInt(s);if(l<1||l>12||c<1||c>31)return e;const d=new Date(parseInt(i),l-1,c,parseInt(o),parseInt(a),parseInt(r));return d.getMonth()!==l-1||d.getDate()!==c?e:`${d.toLocaleDateString("en-US",{weekday:"short"})}, ${d.toLocaleDateString("en-US",{month:"short"})} ${d.getDate()} ${d.getFullYear()}`})(`${i}:${n}`.split(".")[0]);return{value:t,label:`${s} (${a}): ${o}`,description:r}})))),[l]),b=(null===(t=l[d])||void 0===t?void 0:t.images.length)>1,w=(0,n.useMemo)((()=>{if(void 0===l[d])return{};const e=l[d].images.length;return{1:"1",[Math.ceil(e/2)]:String(Math.ceil(e/2)),[e]:String(e)}}),[d,l]),x=(0,n.useMemo)((()=>{var e;const t=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.map(((e,n)=>{const s=void 0!==i?`${i}-${n}`:`${n}`,o={key:s,tag:e.tag,vr:e.vr,keyword:e.keyword,value:e.value};return void 0!==e.children&&e.children.length>0&&(o.children=t(e.children,s)),o}))};if(void 0===l[d])return[];const i=Xt(null===(e=l[d])||void 0===e?void 0:e.images[u-1]);return t(i)}),[u,d,l]),A=(0,n.useMemo)((()=>{if(void 0===g||""===g)return x;const e=g.toLowerCase(),t=[],i=function(n){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return n.map((n=>{var o,a,r,l,c,d,h,u;const p={...n},m=(null!==(o=null===(a=n.tag)||void 0===a?void 0:a.toLowerCase())&&void 0!==o?o:"").includes(e)||(null!==(r=null===(l=n.vr)||void 0===l?void 0:l.toLowerCase())&&void 0!==r?r:"").includes(e)||(null!==(c=null===(d=n.keyword)||void 0===d?void 0:d.toLowerCase())&&void 0!==c?c:"").includes(e)||(null!==(h=null===(u=n.value)||void 0===u?void 0:u.toString().toLowerCase())&&void 0!==h?h:"").includes(e);if(null!=n.children){const e=i(n.children,n.key);if(p.children=e,m||e.length>0)return void 0!==s&&t.push(s),t.push(n.key),p}return m?p:null})).filter((e=>null!==e))},n=i(x);return f(t),n}),[x,g]);(0,n.useEffect)((()=>{void 0!==g&&""!==g||f([])}),[g]);const D=(0,n.useMemo)((()=>[...new Set([...v,...C])]),[v,C]);return r?(0,p.jsx)("div",{children:"Loading..."}):(0,p.jsx)("div",{className:"dicom-tag-browser",children:(0,p.jsxs)("div",{style:{width:"100%",padding:"16px 20px 20px"},children:[(0,p.jsxs)("div",{style:{display:"flex",gap:"24px",marginBottom:"32px"},children:[(0,p.jsxs)("div",{style:{flex:1},children:[(0,p.jsx)(qt.A.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"Slides"}),(0,p.jsx)(J.A,{style:{width:"100%"},value:d,defaultValue:0,onChange:e=>{h(e),m(1)},optionLabelProp:"label",optionFilterProp:"label",children:I.map((e=>(0,p.jsx)(Kt,{value:e.value,label:e.label,children:(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{children:e.label}),(0,p.jsx)("div",{style:{fontSize:"12px",color:"rgba(0, 0, 0, 0.45)"},children:e.description})]})},e.value)))})]}),b&&(0,p.jsxs)("div",{style:{flex:1},children:[(0,p.jsxs)(qt.A.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:["Instance Number: ",u]}),(0,p.jsx)(ve.A,{min:1,max:null===(i=l[d])||void 0===i?void 0:i.images.length,value:u,onChange:e=>m(e),marks:w,tooltip:{formatter:e=>void 0!==e?`Instance ${e}`:""}})]})]}),(0,p.jsx)(Tt.A,{style:{marginBottom:"20px"},placeholder:"Search DICOM tags...",prefix:(0,p.jsx)(zt.A,{}),onChange:e=>S(e.target.value),value:g}),(0,p.jsx)(Ft.A,{columns:[{title:"Tag",dataIndex:"tag",key:"tag",width:"30%"},{title:"VR",dataIndex:"vr",key:"vr",width:"5%"},{title:"Keyword",dataIndex:"keyword",key:"keyword",width:"30%"},{title:"Value",dataIndex:"value",key:"value",width:"40%"}],dataSource:A,pagination:!1,expandable:{expandedRowKeys:D,onExpandedRowsChange:e=>y(e)},size:"small",scroll:{y:500}})]})})};class Jt extends n.Component{constructor(e){super(e),this.handleInfoButtonClick=()=>{const e=(0,Gt.o0)(),t={browser:{},os:{}};null!=e&&(t.browser={name:null!=e.name?e.name:void 0,version:null!=e.version?e.version:void 0},t.os={name:null!=e.os?e.os:void 0}),oe.A.info({title:"About",width:600,content:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(h.A,{title:"Application",column:1,children:[(0,p.jsx)(h.A.Item,{label:"Name",children:this.props.app.name}),(0,p.jsx)(h.A.Item,{label:"Version",children:this.props.app.version}),(0,p.jsx)(h.A.Item,{label:"Homepage",children:this.props.app.homepage})]}),(0,p.jsxs)(h.A,{title:"Browser",column:1,children:[(0,p.jsx)(h.A.Item,{label:"Name",children:t.browser.name}),(0,p.jsx)(h.A.Item,{label:"Version",children:t.browser.version})]}),(0,p.jsx)(h.A,{title:"Operating System",column:1,children:(0,p.jsx)(h.A.Item,{label:"Name",children:t.os.name})})]}),onOk(){}})},this.handleDicomTagBrowserButtonClick=()=>{var e;const t=window.innerWidth-200;oe.A.info({title:"DICOM Tag Browser",width:t,content:(0,p.jsx)(Qt,{clients:this.props.clients,studyInstanceUID:null!==(e=this.props.params.studyInstanceUID)&&void 0!==e?e:""}),onOk(){}})},this.handleDebugButtonClick=()=>{const e={Authentication:[],Communication:[],EncodingDecoding:[],Visualization:[]},t=this.state.errorObj.length;if(t>0)for(let o=0;o<t;o++){e[this.state.errorCategory[o]].push(`${this.state.errorObj[o].message} (Source: ${this.state.errorObj[o].source})`)}const{Panel:i}=Et.A,n=e=>(0,p.jsx)(Ce.A,{count:e});var s;oe.A.info({title:"Debug Information\n (Check console for more information)",width:800,content:(0,p.jsxs)(Et.A,{children:[(0,p.jsx)(i,{header:"Communication Error",extra:n(e.Communication.length),children:(0,p.jsx)("ol",{children:e.Communication.map((e=>(0,p.jsx)("li",{children:e},(0,d.A)())))})},"communicationerror"),(0,p.jsx)(i,{header:"Data Encoding/Decoding error",extra:n(e.EncodingDecoding.length),children:(0,p.jsx)("ol",{children:e.EncodingDecoding.map((e=>(0,p.jsx)("li",{children:e},(0,d.A)())))})},"encodedecodeerror"),(0,p.jsx)(i,{header:"Visualization error",extra:n(e.Visualization.length),children:(0,p.jsx)("ol",{children:e.Visualization.map((e=>(0,p.jsx)("li",{children:e},(0,d.A)())))})},"visualizationerror"),(0,p.jsx)(i,{header:"Authentication error",extra:n(e.Authentication.length),children:(0,p.jsx)("ol",{children:e.Authentication.map((e=>(0,p.jsx)("li",{children:e},(0,d.A)())))})},"autherror"),(0,p.jsx)(i,{header:"Warning",extra:(s=this.state.warnings.length,(0,p.jsx)(Ce.A,{color:"green",count:s})),children:(0,p.jsx)("ol",{children:this.state.warnings.map((e=>(0,p.jsx)("li",{children:e},(0,d.A)())))})},"warning")]}),onOk(){}})},this.handleServerSelectionButtonClick=()=>{this.setState({isServerSelectionModalVisible:!0})},this.state={isServerSelectionModalVisible:!1,isServerSelectionDisabled:!0,errorObj:[],errorCategory:[],warnings:[]};Y.subscribe(k,(e=>{let{source:t,error:i}=e;this.setState((e=>({...e,errorObj:[...e.errorObj,{...i,source:t}],errorCategory:[...e.errorCategory,i.type]})))})),Y.subscribe(_,(e=>{this.setState((t=>({...t,warnings:[...t.warnings,e]})))}))}componentDidUpdate(e,t){(t.warnings.length>0||t.errorObj.length>0)&&this.props.location.pathname!==e.location.pathname&&this.setState({isServerSelectionModalVisible:!1,isServerSelectionDisabled:!0,errorObj:[],errorCategory:[],warnings:[]})}render(){let e,t=null;if(void 0!==this.props.user){const e=[];void 0!==this.props.onUserLogout&&e.push({label:"Logout",key:"user-logout",onClick:()=>{void 0!==this.props.onUserLogout&&this.props.onUserLogout()}});const i={items:e};t=(0,p.jsx)(Ut.A,{menu:i,trigger:["click"],children:(0,p.jsx)(De,{icon:Lt.A,onClick:e=>e.preventDefault(),label:`${this.props.user.name} (${this.props.user.email})`})})}this.props.showWorklistButton&&(e=(0,p.jsx)(o.k2,{to:"/",children:(0,p.jsx)(De,{icon:kt.A,tooltip:"Go to worklist"})}));const i=(0,p.jsx)(De,{icon:_t.A,tooltip:"Get app info",onClick:this.handleInfoButtonClick}),n=(0,p.jsx)(Ce.A,{count:this.state.errorObj.length,children:(0,p.jsx)(Ce.A,{color:"green",count:this.state.warnings.length,children:(0,p.jsx)(De,{icon:fe.A,tooltip:"Debug info",onClick:this.handleDebugButtonClick})})}),s=this.props.location.pathname.includes("/studies/")?(0,p.jsx)(De,{icon:Nt.A,tooltip:"Dicom Tag Browser",onClick:this.handleDicomTagBrowserButtonClick}):null;let a;this.props.showServerSelectionButton&&(a=(0,p.jsx)(De,{icon:$t.A,tooltip:"Select server",onClick:this.handleServerSelectionButtonClick}));const l=()=>{const e=this.state.selectedServerUrl;let t=!1;null!=e&&""!==e&&(e.startsWith("http://")||e.startsWith("https://"))&&(this.props.onServerSelection({url:e}),t=!0),this.setState({selectedServerUrl:void 0,isServerSelectionModalVisible:!t,isServerSelectionDisabled:!0})};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(r.A.Header,{style:{width:"100%",padding:"0 14px"},children:(0,p.jsxs)(ne.A,{children:[(0,p.jsx)(Se.A,{children:(0,p.jsx)(ee.A,{align:"center",direction:"horizontal",children:(0,p.jsx)("img",{src:"https://imagingdatacommons.github.io/slim/logo.svg",alt:"",style:{height:"64px",margin:"-14px"}})})}),(0,p.jsx)(Se.A,{flex:"auto"}),(0,p.jsx)(Se.A,{children:(0,p.jsxs)(ee.A,{direction:"horizontal",children:[e,i,n,s,a,t]})})]})}),(0,p.jsx)(oe.A,{open:this.state.isServerSelectionModalVisible,title:"Select DICOMweb server",onOk:l,onCancel:()=>{this.setState({selectedServerUrl:void 0,isServerSelectionModalVisible:!1,isServerSelectionDisabled:!0})},children:(0,p.jsx)(Tt.A,{placeholder:"Enter base URL of DICOMweb Study Service",onChange:e=>{const t=e.currentTarget.value;let i=!0;if(null!=t)try{const e=new URL(t);e.protocol.startsWith("http")&&e.pathname.length>0&&(i=!1)}catch(n){}this.setState({selectedServerUrl:t,isServerSelectionDisabled:i})},onPressEnter:l,addonAfter:this.state.isServerSelectionDisabled?(0,p.jsx)(ce.A,{style:{color:"rgba(0,0,0,.45)"}}):(0,p.jsx)(le.A,{style:{color:"rgba(0,0,0,.45)"}})})})]})}}const Zt=rt(Jt);var ei=i(9923);const ti=e=>{let{title:t,message:i}=e;return(0,p.jsx)("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,p.jsx)(ei.Ay,{title:t,subTitle:i})})};class ii extends n.Component{constructor(e){super(e),this.defaultPageSize=20,this.handleSearch=(e,t,i)=>{t()},this.handleReset=e=>{e()},this.getColumnSearchProps=e=>({filterDropdown:t=>{let{setSelectedKeys:i,selectedKeys:n,confirm:s,clearFilters:o}=t;return(0,p.jsxs)("div",{style:{padding:8},children:[(0,p.jsx)(Tt.A,{placeholder:"Search",value:String(n[0]),onChange:e=>i(void 0!==e.target.value?[e.target.value]:[]),onPressEnter:()=>this.handleSearch(n,s,e),style:{width:188,marginBottom:8,display:"block"}}),(0,p.jsxs)(ee.A,{children:[(0,p.jsx)(ie.A,{type:"primary",onClick:()=>this.handleSearch(n,s,e),icon:(0,p.jsx)(zt.A,{}),size:"small",style:{width:90},children:"Search"}),(0,p.jsx)(ie.A,{onClick:()=>this.handleReset(o),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,p.jsx)(zt.A,{style:{color:e?"#1890ff":void 0}})}),this.fetchData=this.fetchData.bind(this),this.handleClick=this.handleClick.bind(this),this.handleChange=this.handleChange.bind(this),this.state={studies:[],isLoading:!1,numStudies:0,pageSize:this.defaultPageSize}}searchForStudies(){const e={queryParams:{ModalitiesInStudy:"SM"}};this.props.clients[V.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE].searchForStudies(e).then((e=>{this.setState({numStudies:e.length,studies:e.slice(0,this.state.pageSize).map((e=>{const{dataset:t}=D.metadata.formatMetadata(e);return t}))})})).catch((e=>{console.error(e),Y.onError(N,new L(E,"An error occured. Search for studies failed."))}))}componentDidMount(){this.searchForStudies()}componentDidUpdate(e){this.props.clients!==e.clients&&this.searchForStudies()}handleClick(e,t){this.props.navigate(`/studies/${t.StudyInstanceUID}`)}fetchData(e){let{offset:t,limit:i,searchCriteria:n}=e;const s={ModalitiesInStudy:"SM",offset:t,limit:i};if(void 0!==n){for(const e in n){const t=n[e];s[e]="PersonName"===e?`*${t}*`:t}s.fuzzymatching="true"}const o={queryParams:s};this.props.clients[V.VL_WHOLE_SLIDE_MICROSCOPY_IMAGE].searchForStudies(o).then((e=>{this.setState({studies:e.map((e=>{const{dataset:t}=D.metadata.formatMetadata(e);return t}))})})).catch((e=>{console.error(e),Y.onError(N,new L(E,"Request to search for studies failed."))}))}handleChange(e,t){this.setState({isLoading:!0});let i=e.current;void 0===i&&(i=1);let n=e.pageSize;void 0===n&&(n=this.state.pageSize);const s=n*(i-1),o=n;console.debug(`search for studies of page #${i}...`);const a={};for(const r in t)null!==t[r]&&(a[r]=t[r][0].toString());this.fetchData({offset:s,limit:o,searchCriteria:a}),this.setState({isLoading:!1,pageSize:n})}render(){const e=[{title:"Accession Number",dataIndex:"AccessionNumber",...this.getColumnSearchProps("AccessionNumber")},{title:"Study ID",dataIndex:"StudyID",...this.getColumnSearchProps("StudyID")},{title:"Study Date",dataIndex:"StudyDate",render:e=>C(e)},{title:"Study Time",dataIndex:"StudyTime",render:e=>f(e)},{title:"Patient ID",dataIndex:"PatientID",...this.getColumnSearchProps("PatientID")},{title:"Patient's Name",dataIndex:"PatientName",render:e=>y(e),...this.getColumnSearchProps("PatientName")},{title:"Patient's Sex",dataIndex:"PatientSex",render:e=>I(e)},{title:"Patient's Birthdate",dataIndex:"PatientBirthDate",render:e=>C(e)},{title:"Referring Physician's Name",dataIndex:"ReferringPhysicianName",render:e=>y(e)},{title:"Modalities in Study",dataIndex:"ModalitiesInStudy",render:e=>void 0===e?"":String(e)}],t={defaultPageSize:this.defaultPageSize,pageSize:this.state.pageSize,hideOnSinglePage:!0,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} studies`,total:this.state.numStudies};return(0,p.jsx)(Ft.A,{style:{cursor:"pointer"},columns:e,rowKey:e=>e.StudyInstanceUID,dataSource:this.state.studies,pagination:t,onRow:e=>({onClick:t=>this.handleClick(t,e)}),onChange:this.handleChange,size:"small",loading:this.state.isLoading})}}const ni=rt(ii);var si=i(6958);const oi=(e,t)=>{let i=t;i.endsWith("/")||(i+="/");return new URL(e,i).toString()},ai=e=>{let t;if(null!==e&&(t=e.profile),void 0!==t){if(void 0!==t.name&&void 0!==t.email)return{name:t.name,email:t.email};Y.onError(F,new L(P,'Failed to obtain user "name" and "email".'))}else Y.onError(F,new L(P,"Failed to obtain user profile."));return{name:void 0,email:void 0}};class ri{constructor(e,t){this._oidc=void 0,this.signIn=async e=>{let{onSignIn:t}=e;const i=e=>{const i=ai(e),n=`${e.token_type} ${e.access_token}`;null!=t?(console.info("handling sign-in using provided callback function"),t({user:i,authorization:n})):console.warn("no callback function was provided to handle sign-in")};if((e=>{var t,i,n,s,o;const a=new URLSearchParams(e.search),r=new URLSearchParams(e.hash.replace("#","?"));return Boolean(null!==(t=null!==(i=null!==(n=null!==(s=null!==(o=a.get("code"))&&void 0!==o?o:a.get("id_token"))&&void 0!==s?s:a.get("session_state"))&&void 0!==n?n:r.get("code"))&&void 0!==i?i:r.get("id_token"))&&void 0!==t?t:r.get("session_state"))})(window.location)){console.info("obtaining authorization");const e=await this._oidc.signinCallback();null!=e&&(console.info("obtained user data: ",e),i(e))}else{const e=await this._oidc.getUser();null===e||e.expired?(console.info("authenticating user"),await this._oidc.signinRedirect()):(console.info("user has already been authenticated"),i(e))}},this.signOut=async()=>(console.log("signing out user and revoking authorization"),await this._oidc.signoutRedirect()),this.getAuthorization=async()=>await this._oidc.getUser().then((e=>{if(null!==e)return e.access_token;Y.onError(F,new L(P,"Failed to obtain user profile."))})),this.getUser=async()=>await this._oidc.getUser().then((e=>(null===e&&Y.onError(F,new L(P,"Failed to obtain user information.")),ai(e))));let i="code";void 0!==t.grantType&&"implicit"===t.grantType&&(i="id_token token"),this._oidc=new si.UserManager({authority:t.authority,client_id:t.clientId,redirect_uri:e,scope:t.scope,response_type:i,loadUserInfo:!0,automaticSilentRenew:!0,revokeAccessTokenOnSignout:!0,post_logout_redirect_uri:`${e}/logout`}),null!=t.endSessionEndpoint&&this._oidc.metadataService.getMetadata().then((n=>{null!=t.endSessionEndpoint&&(n.end_session_endpoint=t.endSessionEndpoint,this._oidc=new si.UserManager({authority:t.authority,client_id:t.clientId,redirect_uri:e,scope:t.scope,response_type:i,loadUserInfo:!0,automaticSilentRenew:!0,revokeAccessTokenOnSignout:!0,post_logout_redirect_uri:`${e}/logout`,metadata:n}))})).catch((e=>{console.error("failed to get metadata from authorization server: ",e)}))}}var li=i(4785),ci=i(302);const di=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{retries:5,factor:3,minTimeout:1e3,maxTimeout:6e4,randomize:!0,retryableStatusCodes:[429,500]};const t=e;null!=e.retries&&(t.retries=e.retries),null!=e.factor&&(t.factor=e.factor),null!=e.minTimeout&&(t.minTimeout=e.minTimeout),null!=e.maxTimeout&&(t.maxTimeout=e.maxTimeout),null!=e.randomize&&(t.randomize=e.randomize),null!=e.retryableStatusCodes&&(t.retryableStatusCodes=e.retryableStatusCodes);return(e,i)=>{const{url:n,method:s}=i;const o=e.send;return e.send=function(){const i=ci.operation(t);i.attempt((function(o){const a=e.onreadystatechange;e.onreadystatechange=function(){if(null!=a){for(var s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];a.apply(e,o)}if(t.retryableStatusCodes.includes(e.status)){const e=new Error(`Attempt to request ${n} failed.`);i.retry(e)}},o>1&&(console.warn(`Requesting ${n}... (attempt: ${o})`),e.open(s,n,!0))}));for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];o.apply(e,r)},e}};class hi{constructor(e){let{baseUri:t,settings:i,onError:n}=e;this.stores=[],this.handleError=void 0,this.updateHeaders=e=>{for(const t in e)this.stores[0].client.headers[t]=e[t]},this.storeInstances=async e=>this.stores[0].write?await this.stores[0].client.storeInstances(e):await Promise.reject(new Error("Store is not writable.")),this.searchForStudies=async e=>await this.stores[0].client.searchForStudies(e),this.searchForSeries=async e=>await this.stores[0].client.searchForSeries(e),this.searchForInstances=async e=>await this.stores[0].client.searchForInstances(e),this.retrieveStudyMetadata=async e=>await this.stores[0].client.retrieveStudyMetadata(e),this.retrieveSeriesMetadata=async e=>await this.stores[0].client.retrieveSeriesMetadata(e),this.retrieveInstanceMetadata=async e=>await this.stores[0].client.retrieveInstanceMetadata(e),this.retrieveInstance=async e=>await this.stores[0].client.retrieveInstance(e),this.retrieveInstanceFrames=async e=>await this.stores[0].client.retrieveInstanceFrames(e),this.retrieveInstanceRendered=async e=>await this.stores[0].client.retrieveInstanceRendered(e),this.retrieveInstanceFramesRendered=async e=>await this.stores[0].client.retrieveInstanceFramesRendered(e),this.retrieveBulkData=async e=>await this.stores[0].client.retrieveBulkData(e),this.handleError=null!=n?n:(e,t)=>{console.error(e,t)},i.forEach((e=>{var i,n;let s;void 0===e&&Y.onError(q,new L(E,"At least one server needs to be configured.")),void 0!==e.url?s=e.url:void 0!==e.path?s=oi(e.path,t):Y.onError(q,new L(E,"Either path or full URL needs to be configured for server."));const o={url:s},a=!0===e.upgradeInsecureRequests&&[s,e.qidoPathPrefix,e.wadoPathPrefix,e.stowPathPrefix].some((e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.startsWith("https"))&&void 0!==t&&t}));void 0!==e.qidoPathPrefix&&(o.qidoURLPrefix=e.qidoPathPrefix),void 0!==e.wadoPathPrefix&&(o.wadoURLPrefix=e.wadoPathPrefix),void 0!==e.stowPathPrefix&&(o.stowURLPrefix=e.stowPathPrefix),a&&(o.headers={...o.headers,"Content-Security-Policy":"upgrade-insecure-requests"}),void 0!==e.retry&&(o.requestHooks=[di(e.retry)]),o.errorInterceptor=t=>{this.handleError(t,e)},this.stores.push({id:e.id,write:null!==(i=e.write)&&void 0!==i&&i,read:null===(n=e.read)||void 0===n||n,client:new li.FH.DICOMwebClient(o)})})),this.stores.length>1&&Y.onError(q,new L(E,"Only one store is supported for now."))}get baseURL(){return this.stores[0].client.baseURL}get headers(){return this.stores[0].client.headers}}function ui(e){var t,i;let{clients:n,user:o,app:a,config:r}=e;const{studyInstanceUID:l}=(0,s.g)(),c=!(null!==(t=r.disableAnnotationTools)&&void 0!==t&&t),d=null!==(i=r.preload)&&void 0!==i&&i;return(0,p.jsx)(Pt,{clients:n,user:o,annotations:r.annotations,preload:d,app:a,enableAnnotationTools:c,studyInstanceUID:l})}function pi(e){let{baseUri:t,gcpBaseUrl:i,settings:n,onError:s}=e;const o={default:0},a={};n.forEach((e=>{if(null!=e.storageClasses)e.storageClasses.forEach((t=>{Object.values(V).includes(t)?t in o?o[t]+=1:o[t]=1:console.warn(`unknown storage class "${t}" specified for configured server "${e.id}"`)}));else{if(window.location.pathname.includes("/projects/")){const t=window.location.pathname.split("/study/")[0],n=`${i}${t}/dicomWeb`;e.url=n}o.default+=1,a.default=new hi({baseUri:t,settings:[e],onError:s})}})),o.default>1&&Y.onError(q,new L(E,"Only one default server can be configured without specification of storage classes."));for(const r in o)"default"!==r&&o[r]>1&&Y.onError(q,new L(E,`Only one configured server can specify a given storage class. Storage class "${r}" is specified by more than one of the configured servers.`));return Object.keys(o).length>1&&n.forEach((e=>{const i=new hi({baseUri:t,settings:[e],onError:s});null!=e.storageClasses&&e.storageClasses.forEach((e=>{a[e]=i}))})),Object.values(V).forEach((e=>{e in a||(a[e]=a.default)})),a}class mi extends n.Component{constructor(e){var t;super(e),this.auth=void 0,this.handleDICOMwebError=(e,t)=>{401===e.status?this.signIn():403===e.status&&Y.onError(N,new L(E,"User is not authorized to access DICOMweb resources."));const i=()=>{Y.onError(N,new L(E,"An unexpected server error occured."))};void 0!==t.errorMessages?t.errorMessages.forEach((t=>{e.status===t.status?this.setState({error:{status:e.status,message:t.message}}):500===e.status&&i()})):500===e.status&&i()},this.handleSignIn=e=>{let{user:t,authorization:i}=e;for(const o in this.state.clients){this.state.clients[o].updateHeaders({Authorization:i})}const n=window.localStorage.getItem("slim_path"),s=window.localStorage.getItem("slim_search");if(null!=n){if(n!==window.location.pathname){let e=n;null!=s&&(e+=s),window.location.href=e}}window.localStorage.removeItem("slim_path"),window.localStorage.removeItem("slim_search"),this.setState({user:t})},console.info("instatiate app"),console.info(`app is located at "${e.config.path}"`);const{protocol:i,host:n}=window.location,s=`${i}//${n}`,o=oi(e.config.path,s),r=e.config.oidc;void 0!==r&&(console.info("app uses the following OIDC configuration: ",e.config.oidc),this.auth=new ri(o,r)),0===e.config.servers.length&&Y.onError(q,new L(E,"One server needs to be configured.")),console.info("app uses the following DICOMweb server configuration: ",e.config.servers),this.handleServerSelection=this.handleServerSelection.bind(this),a.Ay.config({duration:5}),this.addGcpSecondaryAnnotationServer(e.config),this.state={clients:pi({baseUri:s,gcpBaseUrl:null!==(t=e.config.gcpBaseUrl)&&void 0!==t?t:"https://healthcare.googleapis.com/v1",settings:e.config.servers,onError:this.handleDICOMwebError}),isLoading:!0,wasAuthSuccessful:!1}}addGcpSecondaryAnnotationServer(e){const t="gcp_secondary_annotation_server",i=new URLSearchParams(window.location.search).get("gcp");void 0===e.servers.find((e=>e.id===t))&&"string"===typeof i&&e.servers.push({id:t,write:!0,url:i,storageClasses:[V.COMPREHENSIVE_SR,V.COMPREHENSIVE_3D_SR,V.SEGMENTATION,V.MICROSCOPY_BULK_SIMPLE_ANNOTATION,V.PARAMETRIC_MAP,V.ADVANCED_BLENDING_PRESENTATION_STATE,V.COLOR_SOFTCOPY_PRESENTATION_STATE,V.GRAYSCALE_SOFTCOPY_PRESENTATION_STATE,V.PSEUDOCOLOR_SOFTCOPY_PRESENTATION_STATE]})}handleServerSelection(e){let{url:t}=e;console.info("select DICOMweb server: ",t);const i=new hi({baseUri:"",settings:[{id:"tmp",url:t,read:!0,write:!1}],onError:this.handleDICOMwebError});i.updateHeaders(this.state.clients.default.headers),this.setState((e=>{const t={};for(const n in e.clients)t[n]=i;return{clients:t}}))}signIn(){void 0!==this.auth?(console.info("try to sign in user"),this.auth.signIn({onSignIn:this.handleSignIn}).then((()=>{console.info("sign-in was successful"),this.setState({isLoading:!1,wasAuthSuccessful:!0})})).catch((e=>{console.error(e),Y.onError(F,new L(P,"Could not sign-in user.")),this.setState({isLoading:!1,redirectTo:void 0,wasAuthSuccessful:!1})}))):this.setState({isLoading:!1,redirectTo:void 0,wasAuthSuccessful:!0})}componentDidMount(){null==window.localStorage.getItem("slim_path")&&(window.localStorage.setItem("slim_path",window.location.pathname),window.localStorage.setItem("slim_search",window.location.search)),this.signIn()}render(){var e,t;const i={name:this.props.name,version:this.props.version,homepage:this.props.homepage,uid:"1.2.826.0.1.3680043.9.7433.1.5",organization:this.props.config.organization},n=!(null!==(e=this.props.config.disableWorklist)&&void 0!==e&&e),a=null!==(t=this.props.config.enableServerSelection)&&void 0!==t&&t;let c;c=n?(0,p.jsx)(ni,{clients:this.state.clients}):(0,p.jsx)("div",{children:"Worklist has been disabled."});let d,h=!1;null!=this.props.config.oidc&&null!=this.props.config.oidc.endSessionEndpoint?(d=()=>{null!=this.auth&&this.auth.signOut()},h=!0):(d=()=>{},h=!1);const u={height:"100vh"},m={height:"100%"};return void 0!==this.state.redirectTo?(0,p.jsx)(o.Kd,{basename:this.props.config.path,children:(0,p.jsx)(s.C5,{to:this.state.redirectTo,replace:!0})}):this.state.isLoading?(0,p.jsx)(o.Kd,{basename:this.props.config.path,children:(0,p.jsxs)(r.A,{style:u,children:[(0,p.jsx)(Zt,{app:i,user:this.state.user,showWorklistButton:!1,onServerSelection:this.handleServerSelection,showServerSelectionButton:!1,clients:this.state.clients}),(0,p.jsx)(r.A.Content,{style:m,children:(0,p.jsx)(l.hW,{})})]})}):this.state.wasAuthSuccessful?null!=this.state.error?(0,p.jsx)(ti,{type:"error",message:this.state.error.message}):(0,p.jsx)(o.Kd,{basename:this.props.config.path,children:(0,p.jsxs)(s.BV,{children:[(0,p.jsx)(s.qh,{path:"/",element:(0,p.jsxs)(r.A,{style:u,children:[(0,p.jsx)(Zt,{app:i,user:this.state.user,showWorklistButton:!1,onServerSelection:this.handleServerSelection,onUserLogout:h?d:void 0,showServerSelectionButton:a}),(0,p.jsx)(r.A.Content,{style:m,children:c})]})}),(0,p.jsx)(s.qh,{path:"/studies/:studyInstanceUID/*",element:(0,p.jsxs)(r.A,{style:u,children:[(0,p.jsx)(Zt,{app:i,user:this.state.user,showWorklistButton:n,onServerSelection:this.handleServerSelection,onUserLogout:h?d:void 0,showServerSelectionButton:a}),(0,p.jsx)(r.A.Content,{style:m,children:(0,p.jsx)(ui,{clients:this.state.clients,user:this.state.user,config:this.props.config,app:i})})]})}),(0,p.jsx)(s.qh,{path:"/projects/:project/locations/:location/datasets/:dataset/dicomStores/:dicomStore/study/:studyInstanceUID/*",element:(0,p.jsxs)(r.A,{style:u,children:[(0,p.jsx)(Zt,{app:i,user:this.state.user,showWorklistButton:n,onServerSelection:this.handleServerSelection,onUserLogout:h?d:void 0,showServerSelectionButton:a}),(0,p.jsx)(r.A.Content,{style:m,children:(0,p.jsx)(ui,{clients:this.state.clients,user:this.state.user,config:this.props.config,app:i})})]})}),(0,p.jsx)(s.qh,{path:"/logout",element:(0,p.jsxs)(r.A,{style:u,children:[(0,p.jsx)(Zt,{app:i,user:this.state.user,showWorklistButton:!1,onServerSelection:this.handleServerSelection,onUserLogout:h?d:void 0,showServerSelectionButton:a}),"Logged out"]})})]})}):(0,p.jsx)(ti,{type:"error",message:"Sign-in failed."})}}const gi=mi}}]);
//# sourceMappingURL=921.11791cb8.chunk.js.map